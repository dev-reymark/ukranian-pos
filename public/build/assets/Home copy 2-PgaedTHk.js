import{r as s,j as e,Y as de,a as g}from"./app-CG3hSCCP.js";import{S as me}from"./sweetalert2.all-BvbZxT3j.js";import{F as ue}from"./PumpDelivery-DKYkkHoC.js";import{I as pe,_ as i}from"./index-BVszRs1M.js";import fe from"./SaleWindowTabs-DQa1OPIt.js";import ge from"./MOPCard-CbYgKfTK.js";import he,{buttons as xe}from"./POSKeyboard-tkZVPNsQ.js";import{PumpCard as Se}from"./PumpCard-D0bNqDpe.js";import{CustomerDetails as ve}from"./CustomerDetails-CNZroYxz.js";import{PrinterStatus as be}from"./PrinterStatus-AxnLUmHn.js";import{GetDateTime as Ne}from"./GetDateTime-JSbjFobY.js";import{ThemeSwitcher as ye}from"./ThemeSwitcher-D9T0mecQ.js";import je from"./Index-CMOi7o2k.js";import{c as b}from"./chunk-H4VOEXHF-CGkO2XOs.js";import{c as we}from"./chunk-J333S7JQ-BhlAOaIT.js";import{c as Ce}from"./chunk-5ALFRFZW-AcYRgPLA.js";import{s as Ie}from"./chunk-IXXDDLGU-MaXzxtdl.js";import{i as x}from"./chunk-GQQM5TNQ-rAry1ocd.js";import{t as De,a as P}from"./chunk-FXLYF44B-C38Pb3mE.js";import{m as Pe,a as Oe,b as _e,c as Ee,d as Te}from"./chunk-P2T5LMDM-D2ibxJIr.js";import{b as $}from"./chunk-DBLREEYE-BLo6wnq6.js";import"./iconBase-GnkKZY1p.js";import"./chunk-2PIR7DFM-CbcDDgM_.js";import"./chunk-N2KXC5ZE-Bb84iJeV.js";import"./chunk-YRZGWF2W-C9fHprA-.js";import"./chunk-RQNQ5XFG-Dn3p-Hil.js";import"./chunk-RJKRL3AU-CjtrMR1U.js";import"./chunk-XHQUSKIE-B4ClOMq7.js";import"./SelectionManager-DkK4sEHF.js";import"./FocusScope-CpJfrh8k.js";import"./useFocusable-DuzB0xKt.js";import"./useControlledState-BgNZymqW.js";import"./getScrollParent-s3uJ6ChY.js";import"./useToggleState-DLn7htiY.js";import"./useFormReset-DTEM-02-.js";import"./index-Bvk2_Kd_.js";import"./index-DLPbFJSg.js";import"./chunk-CAFRINWI-BTDo8zfp.js";import"./useFormValidationState-v1uMEGqz.js";import"./VisuallyHidden-DpkvVz1I.js";import"./useHasTabbableChild-CFh5_NKW.js";import"./index-D4o97pR2.js";import"./chunk-44JHHBS2-B1bEk4zQ.js";import"./useLabel-Q8XoHhOL.js";import"./useLabels-DmjHiA4o.js";import"./useListState-DM8uU8-F.js";import"./index-rgXass5n.js";import"./Icon-DCe0_j8J.js";import"./PumpStatus-5SYFXcQO.js";import"./chunk-4WFLSIHH-Ba8tPOwg.js";import"./index-BQmDfF-l.js";import"./chunk-M3MASYO7-DjKVYsRL.js";import"./chunk-JHUBASYZ-BOktjFRo.js";import"./ElectricJournal-C66ayerp.js";import"./chunk-6NL67ZRH-DnhZYCk-.js";import"./index-X92CTFGl.js";import"./AboutSoftware-CEe3qECk.js";import"./ApplicationLogo-052QuPIh.js";import"./chunk-NK4BRF7C-DU22iIEw.js";function Ut(){const[p,c]=s.useState(""),[S,N]=s.useState([]),[y,j]=s.useState([]),[w,f]=s.useState(!1),[m,d]=s.useState(()=>{const t=localStorage.getItem("deliveryData");return t?JSON.parse(t):[]}),[v,O]=s.useState(null),[C,_]=s.useState(!1),[E,G]=s.useState(!1),u=s.useRef(null);s.useState([]);const[T,I]=s.useState(0),[Fe,Y]=s.useState(!1),[Me,W]=s.useState(0),[K,A]=s.useState(!1),[F,M]=s.useState(""),[R,B]=s.useState(""),[X,k]=s.useState(""),[z,J]=s.useState(""),[q,Re]=s.useState(0),Q=async()=>{if((await me.fire({title:"Are you sure?",text:"You are about to log out and you won't be able to recover this session!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, log out!"})).isConfirmed)try{await g.post("/logout"),window.location.href="/"}catch(a){console.error("Error logging out:",a)}},Z=()=>{A(!0)},U=()=>{A(!1)},ee=()=>{U()},te=t=>{d(a=>{const n=[...a,t];return localStorage.setItem("deliveryData",JSON.stringify(n)),n})},ae=()=>{c("")},se=()=>{c(`Subtotal: ₱${h}`)},re=()=>{if(m.length===0){i.error("No transactions to void");return}d([]),localStorage.removeItem("transaction"),localStorage.removeItem("deliveryData"),localStorage.removeItem("disabledIds"),i.success("All transactions voided."),I(0),c(""),window.dispatchEvent(new Event("disabledIdsUpdated"))},oe=()=>{if(console.log("Selected Row:",v),v!==null){const t=m.filter(o=>o.Delivery_ID!==v);d(t),localStorage.setItem("deliveryData",JSON.stringify(t)),i.success("Transaction voided"),O(null);const a=t.reduce((o,l)=>o+parseFloat(l.Amount||0),0).toFixed(2),n=Math.max(0,T-a).toFixed(2);I(T),c(n);const r=localStorage.getItem("disabledIds");if(r){const o=new Set(JSON.parse(r));o.delete(v),localStorage.setItem("disabledIds",JSON.stringify(Array.from(o))),window.dispatchEvent(new Event("disabledIdsUpdated"))}}else i.error("No transaction selected")},L=()=>{G(!0),window.removeEventListener("click",L)};s.useEffect(()=>{window.addEventListener("click",L);const t=()=>{g.get("/get-pump-status").then(r=>{const o=r.data;N(o);const l=o.some(D=>D.Data.NozzleUp);E&&(l&&!C?(u.current&&(u.current.loop=!0,u.current.play().catch(D=>{console.error("Error playing sound:",D)})),_(!0)):!l&&C&&(u.current&&(u.current.pause(),u.current.currentTime=0),_(!1)))}).catch(r=>{console.error("Error fetching pump status:",r)})},a=()=>{g.get("/get-mop").then(r=>{j(r.data.data);const o=data.some(l=>l.MOP_Ref==="3");f(o)}).catch(r=>{console.error("Error fetching MOP list:",r)})};t(),a();const n=setInterval(t,500);return()=>clearInterval(n)},[C,E]);const ne=t=>{c(a=>a+t),I(a=>a+t)},le=async()=>{try{const t=await g.post("/stop-all-pumps");i.success("All pumps stopped successfully"),console.log("All pumps stopped:",t.data)}catch(t){i.error("Error stopping all pumps"),console.error("Error stopping all pumps:",t)}},H=async t=>{if(!t){i.error("Transaction ID is undefined");return}try{const n=(await g.get(`/print-receipt/${t}`)).data}catch(a){i.error("Error fetching receipt data"),console.error("Error fetching receipt data:",a)}},ie={handleLogout:Q,handleVoid:oe,handleVoidAll:re,setInputValue:c,handleClear:ae,handleSubTotal:se,handlePrintReceipt:H,handleStopAllPumps:le,handleOpenCustomerDetails:Z},ce=async t=>{console.log("MOP selected:",t);const a=parseFloat(p.replace("₱","").replace(",",""));if(p===""||a<=0){i.error("Please enter an amount before selecting a method of payment.");return}const n=JSON.parse(localStorage.getItem("transaction"))||{subtotal:parseFloat(h),payments:[],remainingBalance:parseFloat(h)},r=n.remainingBalance-a;if(r>=0)n.payments.push({mopName:t.MOP_Name,amount:a}),n.remainingBalance=r,localStorage.setItem("transaction",JSON.stringify(n)),r===0?await V():c(`Amount Due: ₱${r.toFixed(2)}`);else{const o=Math.abs(r).toFixed(2);i.success(`Payment exceeds the remaining balance. Change: ₱${o}`),n.payments.push({mopName:t.MOP_Name,amount:a}),n.remainingBalance=0,localStorage.setItem("transaction",JSON.stringify(n)),c(`Change: ₱${o}`),await V()}t.MOP_Ref==="3"?f(!0):f(!1)},h=m.reduce((t,a)=>t+parseFloat(a.Amount||0),0).toFixed(2),V=async()=>{const t=JSON.parse(localStorage.getItem("transaction"));if(!t){i.error("No transaction data found");return}const a=t.payments.reduce((r,o)=>r+o.amount,0),n=Math.max(0,a-t.subtotal).toFixed(2);try{const o=(await g.post("/store-transactions",{subtotal:t.subtotal,taxTotal:t.subtotal/1.12*.12,change:parseFloat(n),mopNames:t.payments.map(l=>l.mopName.trim()),mopPayments:t.payments,deliveryIds:m.map(l=>({Delivery_ID:l.Delivery_ID,Pump:l.Pump,Nozzle:l.Nozzle,Volume:l.Volume,Price:l.Price,Amount:l.Amount,FuelGradeName:l.FuelGradeName})),payment:a,customer:{name:F,address:R,tin:X,businessStyle:z}})).data.transaction;o?(localStorage.setItem("transactionId",o),i.success("Transaction saved successfully"),Y(!0),W(0),c("Transaction Complete"),localStorage.removeItem("transaction"),H(o)):i.error("Error retrieving transaction ID")}catch(r){i.error("Error saving transaction"),console.error("Error saving transaction:",r)}};return e.jsxs(e.Fragment,{children:[e.jsx(de,{title:"Home"}),e.jsx("audio",{ref:u,src:"assets/audio/nozzle-status-sound.wav"}),e.jsx("div",{className:"min-h-screen dark:bg-gray-900 p-3",children:e.jsx("main",{className:"w-full h-full mx-auto",children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2 lg:gap-4",children:[e.jsxs(b,{className:"dark:bg-gray-800 flex flex-col h-full p-3",children:[e.jsx("div",{children:e.jsxs(b,{className:"max-w-full",children:[e.jsx(we,{className:"justify-between",children:e.jsx(Ne,{})}),e.jsx(Ce,{className:"justify-between",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-[70%] bg-slate-200 rounded-lg shadow-sm relative",children:e.jsx(pe,{position:"top-right"})}),e.jsx(be,{}),e.jsx(ye,{})]})})]})}),e.jsx(Ie,{y:3}),e.jsx("div",{className:"flex-grow",children:e.jsx(fe,{deliveryData:m,setSelectedRow:O,subtotal:h,inputValue:p,change:q})}),e.jsxs(b,{className:"w-full gap-2 p-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{variant:"bordered",label:e.jsx("p",{className:"font-bold text-xl",children:"SUBTOTAL"}),size:"lg",value:`₱${h}`,labelPlacement:"outside-left",className:"w-[40%]",classNames:{input:["text-black text-xl font-bold text-right"]},isReadOnly:!0}),e.jsx(x,{variant:"bordered",className:"w-[60%]",classNames:{input:["text-black text-2xl font-bold text-right"]},value:p,isReadOnly:!0,size:"lg"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-1",children:e.jsx(he,{handleButtonClick:ne,buttons:xe,buttonClickHandlers:ie,setInputValue:c})})]})]}),e.jsx(b,{className:"dark:bg-gray-800  flex items-start gap-4 rounded-lg bg-white p-6 shadow-[0px_14px_34px_0px_rgba(0,0,0,0.08)] ring-1 ring-white/[0.05] lg:pb-10",children:e.jsx("div",{className:"flex w-full flex-col",children:e.jsxs(De,{"aria-label":"Options",fullWidth:!0,children:[e.jsx(P,{title:"PUMPS",children:S.length===0?e.jsxs("div",{className:"flex flex-col items-center mt-6",children:[e.jsx(ue,{className:"w-12 h-12 text-danger"}),e.jsx("span",{className:"mt-4",children:"No pumps found"})]}):e.jsx("div",{className:"overflow-y-auto max-h-[calc(100vh-200px)] p-2",children:e.jsx("div",{className:"grid grid-cols-4 gap-2",children:S.map(t=>e.jsx(Se,{pump:t,handleAppendDeliveryData:te},t.Id))})})},"pumps"),e.jsx(P,{title:"MOP",children:e.jsx(ge,{mopList:y,onSelectMOP:ce})},"mop"),e.jsx(P,{title:"Config",children:e.jsx(je,{})},"config")]})})})]})})}),e.jsx(ve,{isOpen:K,onClose:U,onCustomerDataChange:(t,a)=>{switch(t){case"name":M(a);break;case"address":B(a);break;case"tin":k(a);break;case"businessStyle":J(a);break}},customerName:F,customerAddress:R,customerTIN:X,customerBusinessStyle:z,onSave:ee,setCustomerName:M,setCustomerAddress:B,setCustomerTIN:k,setCustomerBusinessStyle:J}),e.jsx(Ae,{isOpen:w,onOpenChange:f})]})}const Ae=({isOpen:p,onOpenChange:c})=>{const[S,N]=s.useState(""),[y,j]=s.useState(""),[w,f]=s.useState("");return e.jsx(Pe,{size:"lg",isOpen:p,onOpenChange:c,children:e.jsx(Oe,{children:m=>e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"flex flex-col gap-1",children:"DEBIT/CREDIT CARD INFORMATION"}),e.jsxs(Ee,{children:[e.jsx(x,{autoFocus:!0,label:"Card #",placeholder:"XXX-XXX-XXX-XXX-XXX",variant:"bordered",value:S,onChange:d=>N(d.target.value)}),e.jsx(x,{label:"Approval Code",placeholder:"1234",type:"password",variant:"bordered",value:y,onChange:d=>j(d.target.value)}),e.jsx(x,{label:"Card Holder Name",placeholder:"John Doe",variant:"bordered",value:w,onChange:d=>f(d.target.value)})]}),e.jsxs(Te,{children:[e.jsx($,{className:"w-full",color:"success",children:"Save"}),e.jsx($,{className:"w-full",color:"danger",onPress:m,children:"Close"})]})]})})})};export{Ae as CardDetails,Ut as default};
