import{r as a,j as t,Y as Ne,a as m}from"./app-BgclCP_U.js";import{S as be}from"./sweetalert2.all-uG3e2lQU.js";import{Q as ve,X as we,G as je,B as n}from"./index-DUmXHUp-.js";import Pe from"./MOPCard-CvGEiQ21.js";import Oe,{buttons as Ce}from"./POSKeyboard-C6lBy9vE.js";import{PumpCard as De}from"./PumpCard-CuPwe8sz.js";import{CustomerDetails as Ie}from"./CustomerDetails-Cewu7i4M.js";import{PrinterStatus as Ee}from"./PrinterStatus-CYjSKcHk.js";import{GetCashier as Te}from"./GetCashier-C710YvMF.js";import{GetDateTime as Me}from"./GetDateTime-3h-JBR3J.js";import{ThemeSwitcher as Ae}from"./ThemeSwitcher-DkwrZNqe.js";import _e from"./Index-CWwKe_ix.js";import{CardDetails as Fe}from"./CardDetails-Bw3p3mkq.js";import Re from"./SaleWindowTabs-DJSwARTF.js";import ze from"./ReportsIndex-BMOMziml.js";import{c as y}from"./chunk-H4VOEXHF-TewfOLb0.js";import{c as Be}from"./chunk-J333S7JQ-fhG3Ko0V.js";import{c as ke}from"./chunk-5ALFRFZW-DZJt4FN_.js";import{s as Je}from"./chunk-IXXDDLGU-B3bMcQ9V.js";import{i as W}from"./chunk-GQQM5TNQ-CwUyVOv_.js";import{t as Le,a as N}from"./chunk-FXLYF44B-HLJFA5T_.js";import"./iconBase-D3lqyo71.js";import"./index-Bpea34S8.js";import"./chunk-N2KXC5ZE-OZCedwgk.js";import"./chunk-XHQUSKIE-C9evg4Jy.js";import"./chunk-RJKRL3AU-CjtrMR1U.js";import"./useFocusable-CtZfeggp.js";import"./SelectionManager-fmqYxgu0.js";import"./FocusScope-DU-SyPrP.js";import"./scrollIntoView-SfQOsQd-.js";import"./useControlledState-DEEM-shP.js";import"./chunk-44JHHBS2-C3-jQeuQ.js";import"./useLabel-DpShN-Pb.js";import"./useLabels-Cb_neJ1j.js";import"./useCollator-BBcv62qp.js";import"./useListState-COLDqLzF.js";import"./chunk-RQNQ5XFG-CmL0HLIT.js";import"./index-Dnai1UOS.js";import"./index-DpSBb8zT.js";import"./index-D3TozaOH.js";import"./chunk-P2T5LMDM-reKcKOSN.js";import"./getScrollParent-ClU_Bz4K.js";import"./VisuallyHidden-DfowBU03.js";import"./chunk-6NL67ZRH-DYxa27IY.js";import"./chunk-DBLREEYE-CG8yp442.js";import"./chunk-2PIR7DFM-CbcDDgM_.js";import"./PumpDelivery-C91bALmS.js";import"./chunk-YRZGWF2W-Bu1rOQLJ.js";import"./chunk-KBN3H6OQ-DOSo4uLf.js";import"./useToggleState-DB5UMKni.js";import"./useFormReset-DYDVEd1s.js";import"./chunk-CAFRINWI-BTDo8zfp.js";import"./useFormValidationState-Ct6XxOLM.js";import"./LiveAnnouncer-D-UZuySi.js";import"./useHasTabbableChild-CXsmZ4V0.js";import"./Icon-CpFG_daB.js";import"./PumpStatus-5SYFXcQO.js";import"./chunk-4WFLSIHH-C4LdqOkj.js";import"./index-CWVs8GWl.js";import"./chunk-M3MASYO7-Bt50UMbM.js";import"./chunk-JHUBASYZ-DnA3zP3Q.js";import"./ElectricJournal-DEuL0LDd.js";import"./index-BB6kETrK.js";import"./index-X92CTFGl.js";import"./AboutSoftware-BkquhDUy.js";import"./ApplicationLogo-CjFftTJE.js";import"./chunk-NK4BRF7C-DzQw0L6L.js";import"./PriceChange-B1EUtkJ2.js";import"./chunk-RUXXUVWM-DVz6Pog_.js";function ls(){const[K,Ge]=a.useState([]),[b,c]=a.useState(""),[C,Q]=a.useState([]),[X,q]=a.useState([]),[Z,p]=a.useState(!1),[u,v]=a.useState(()=>{const e=localStorage.getItem("deliveryData");return e?JSON.parse(e):[]}),[h,D]=a.useState(null),[w,I]=a.useState(!1),[E,ee]=a.useState(!1),d=a.useRef(null),[T,Ue]=a.useState([]),[M,j]=a.useState(0),[te,se]=a.useState(!1),[$e,ae]=a.useState(0),[re,A]=a.useState(!1),[_,F]=a.useState(""),[R,z]=a.useState(""),[B,k]=a.useState(""),[J,L]=a.useState(""),[g,G]=a.useState(""),[x,U]=a.useState(""),[S,$]=a.useState(""),oe=async()=>{if((await be.fire({title:"Are you sure?",text:"You are about to log out and you won't be able to recover this session!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, log out!"})).isConfirmed)try{await m.post("/logout"),window.location.href="/"}catch(s){console.error("Error logging out:",s)}},ne=()=>{A(!0)},H=()=>{A(!1)},le=()=>{H()},ie=e=>{v(s=>{const l=[...s,e];return localStorage.setItem("deliveryData",JSON.stringify(l)),l})},ce=()=>{c("")},me=()=>{c(`Subtotal: ₱${f}`)},de=()=>{if(u.length===0){n.error("No transactions to void");return}v([]),localStorage.removeItem("transaction"),localStorage.removeItem("deliveryData"),localStorage.removeItem("disabledIds"),n.success("All transactions voided."),j(0),c(""),window.dispatchEvent(new Event("disabledIdsUpdated"))},pe=()=>{if(console.log("Selected Row:",h),h!==null){const e=u.filter(o=>o.Delivery_ID!==h);v(e),localStorage.setItem("deliveryData",JSON.stringify(e)),n.success("Transaction voided"),D(null);const s=e.reduce((o,i)=>o+parseFloat(i.Amount||0),0).toFixed(2),l=Math.max(0,M-s).toFixed(2);j(M),c(l);const r=localStorage.getItem("disabledIds");if(r){const o=new Set(JSON.parse(r));o.delete(h),localStorage.setItem("disabledIds",JSON.stringify(Array.from(o))),window.dispatchEvent(new Event("disabledIdsUpdated"))}}else n.error("No transaction selected")},V=()=>{ee(!0),window.removeEventListener("click",V)};a.useEffect(()=>{window.addEventListener("click",V);const e=()=>{m.get("/get-pump-status").then(r=>{const o=r.data;Q(o);const i=o.some(O=>O.Data.NozzleUp);E&&(i&&!w?(d.current&&(d.current.loop=!0,d.current.play().catch(O=>{console.error("Error playing sound:",O)})),I(!0)):!i&&w&&(d.current&&(d.current.pause(),d.current.currentTime=0),I(!1)))}).catch(r=>{console.error("Error fetching pump status:",r)})},s=()=>{m.get("/get-mop").then(r=>{q(r.data.data);const o=K.some(i=>i.MOP_Ref==="3");p(o)}).catch(r=>{console.error("Error fetching MOP list:",r)})};e(),s();const l=setInterval(e,500);return()=>clearInterval(l)},[w,E]);const ue=e=>{c(s=>s+e),j(s=>s+e)},fe=async()=>{try{const e=await m.post("/stop-all-pumps");n.success("All pumps stopped successfully"),console.log("All pumps stopped:",e.data)}catch(e){n.error("Error stopping all pumps"),console.error("Error stopping all pumps:",e)}},he=async()=>{try{const e={Type:"FullTank"},s=await m.post("/authorize-all-pumps",e);n.success("All pumps authorized successfully"),console.log("All pumps authorized:",s.data)}catch(e){n.error("Error authorizing all pumps"),console.error("Error authorizing all pumps:",e)}},Y=async e=>{if(!e){n.error("Transaction ID is undefined");return}try{const l=(await m.get(`/print-receipt/${e}`)).data}catch(s){n.error("Error fetching receipt data"),console.error("Error fetching receipt data:",s)}},ge={handleLogout:oe,handleVoid:pe,handleVoidAll:de,setInputValue:c,handleClear:ce,handleSubTotal:me,handlePrintReceipt:Y,handleStopAllPumps:fe,handleAuthorizeAllPumps:he,handleOpenCustomerDetails:ne,handleOpenDrawer:async()=>{try{const e=await m.get("/open-cash-drawer");n.success("Drawer opened successfully"),console.log("Drawer opened:",e.data)}catch(e){n.error("Error opening drawer"),console.error("Error opening drawer:",e.response?e.response.data:e.message)}}},xe=async e=>{console.log("MOP selected:",e);const s=parseFloat(b.replace("₱","").replace(",",""));if(b===""||s<=0){n.error("Please enter an amount before selecting a method of payment.");return}const l=JSON.parse(localStorage.getItem("transaction"))||{subtotal:parseFloat(f),payments:[],remainingBalance:parseFloat(f)},r=l.remainingBalance-s;if(r>=0)l.payments.push({mopName:e.MOP_Name,amount:s}),l.remainingBalance=r,localStorage.setItem("transaction",JSON.stringify(l)),e.MOP_Ref==="3"?p(!0):r===0?await P():c(`Amount Due: ₱${r.toFixed(2)}`);else{const o=Math.abs(r).toFixed(2);n.success(`Change: ₱${o}`),l.payments.push({mopName:e.MOP_Name,amount:s}),l.remainingBalance=0,localStorage.setItem("transaction",JSON.stringify(l)),c(`Change: ₱${o}`),c(`Change: ₱${o}`),e.MOP_Ref==="3"?p(!0):await P()}},f=u.reduce((e,s)=>e+parseFloat(s.Amount||0),0).toFixed(2),[Se,ye]=a.useState({change:0,mopNames:[],mopPayments:[]}),P=async()=>{const e=JSON.parse(localStorage.getItem("transaction"));if(!e){n.error("No transaction data found");return}if(T&&T.MOP_Ref==="3"&&(!g||!x||!S)){n.error("Please provide complete card details."),p(!0);return}const s=e.payments.reduce((r,o)=>r+o.amount,0),l=Math.max(0,s-e.subtotal).toFixed(2);try{const o=(await m.post("/store-transactions",{subtotal:e.subtotal,taxTotal:e.subtotal/1.12*.12,change:parseFloat(l),mopNames:e.payments.map(i=>i.mopName.trim()),mopPayments:e.payments,deliveryIds:u.map(i=>({Delivery_ID:i.Delivery_ID,Pump:i.Pump,Nozzle:i.Nozzle,Volume:i.Volume,Price:i.Price,Amount:i.Amount,FuelGradeName:i.FuelGradeName})),customer:{name:_,address:R,tin:B,businessStyle:J},cardDetails:{name:S,code:x,number:g}})).data.transaction;o?(localStorage.setItem("transactionId",o),n.success("Transaction saved successfully"),se(!0),ae(0),c("Transaction Complete"),ye({change:parseFloat(l),mopNames:e.payments.map(i=>i.mopName),mopPayments:e.payments}),localStorage.removeItem("transaction"),G(""),U(""),$(""),Y(o)):n.error("Error retrieving transaction ID")}catch(r){n.error("Error saving transaction"),console.error("Error saving transaction:",r)}};return t.jsxs(t.Fragment,{children:[t.jsx(Ne,{title:"Home"}),t.jsx("audio",{ref:d,src:"assets/audio/nozzle-status-sound.wav"}),t.jsxs("main",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 p-2 h-[100vh]",children:[t.jsxs(y,{className:"dark:bg-gray-900 p-2",children:[t.jsx("div",{className:"flex-none",children:t.jsxs(y,{className:"max-w-full h-full",children:[t.jsxs(Be,{className:"justify-between",children:[t.jsx(Te,{}),t.jsx(Me,{})]}),t.jsx(ke,{className:"justify-between",children:t.jsxs("div",{className:"flex gap-4",children:[t.jsx("div",{className:"w-[70%] h-[70px] bg-slate-200 rounded-lg shadow-sm relative",children:t.jsx(ve,{position:"top-right",autoClose:2e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!1,theme:"light",transition:we,style:{position:"absolute",top:0,right:0,bottom:0,left:0,width:"100%",height:"50%"}})}),t.jsx(Ee,{}),t.jsx(Ae,{})]})})]})}),t.jsx(Je,{y:3}),t.jsx("div",{className:"flex-grow",children:t.jsx(Re,{deliveryData:u,setSelectedRow:D,subtotal:f,transactionSaved:te,transactionSummary:Se})}),t.jsx("div",{className:"flex-none",children:t.jsxs(y,{className:"w-full gap-2 p-2",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx(W,{variant:"bordered",label:t.jsx("p",{className:"font-bold text-xl",children:"SUBTOTAL"}),size:"lg",value:`₱${f}`,labelPlacement:"outside-left",className:"w-[40%]",classNames:{input:["text-black text-xl font-bold text-right"]},isReadOnly:!0}),t.jsx(W,{variant:"bordered",className:"w-[60%]",classNames:{input:["text-black text-2xl font-bold text-right"]},value:b,isReadOnly:!0,size:"lg"})]}),t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-1",children:t.jsx(Oe,{handleButtonClick:ue,buttons:Ce,buttonClickHandlers:ge,setInputValue:c})})]})})]}),t.jsx(y,{className:"dark:bg-gray-900 p-2",children:t.jsx("div",{className:"flex w-full flex-col",children:t.jsxs(Le,{"aria-label":"Pumps",fullWidth:!0,children:[t.jsx(N,{title:t.jsx("p",{className:"font-extrabold",children:"PUMPS"}),children:t.jsx(a.Suspense,{fallback:t.jsx("div",{children:"Loading..."}),children:C.length===0?t.jsxs("div",{className:"col-span-4 flex flex-col items-center justify-center py-12 text-xl font-extrabold text-center text-red-500",children:[t.jsx(je,{className:"text-7xl"}),t.jsx("p",{children:"No pumps connected!"})]}):t.jsx("div",{className:"overflow-y-auto scrollbar-hide max-h-screen p-1",children:t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2",children:C.map(e=>t.jsx(De,{pump:e,handleAppendDeliveryData:ie},e.Id))})})})},"pumps"),t.jsx(N,{title:t.jsx("p",{className:"font-extrabold",children:"MOP"}),children:t.jsx(Pe,{mopList:X,onSelectMOP:xe})},"mop"),t.jsx(N,{title:t.jsx("p",{className:"font-extrabold",children:"REPORTS"}),children:t.jsx(ze,{})},"reports"),t.jsx(N,{title:t.jsx("p",{className:"font-extrabold",children:"CONFIG"}),children:t.jsx(_e,{})},"config")]})})})]}),t.jsx(Ie,{isOpen:re,onClose:H,onCustomerDataChange:(e,s)=>{switch(e){case"name":F(s);break;case"address":z(s);break;case"tin":k(s);break;case"businessStyle":L(s);break}},customerName:_,customerAddress:R,customerTIN:B,customerBusinessStyle:J,onSave:le,setCustomerName:F,setCustomerAddress:z,setCustomerTIN:k,setCustomerBusinessStyle:L}),t.jsx(Fe,{isOpen:Z,onOpenChange:p,cardNumber:g,setCardNumber:G,approvalCode:x,setApprovalCode:U,cardHolderName:S,setCardHolderName:$,onSave:async()=>{if(!g||!x||!S){n.error("Please fill in all card details.");return}p(!1),await P()}})]})}export{ls as default};
