import{r,j as e,Y as de,a as x}from"./app-CZL9chFl.js";import{F as me}from"./PumpDelivery-DEtEc0CT.js";import{I as ue,_ as o}from"./index-BQye7--Q.js";import{S as pe,t as he,a as $}from"./SaleWindowTabs-C8QCQd0K.js";import fe from"./MOPCard-nXnZcMHt.js";import ge from"./POSKeyboard-Con0gs9l.js";import{P as xe}from"./PumpCard-SYkdoo5f.js";import{c as _}from"./chunk-H4VOEXHF-Di3Z_Bs5.js";import{i as f}from"./chunk-GQQM5TNQ-Cnr-i4s3.js";import{m as Se,a as ve,b as be,c as ye}from"./chunk-P2T5LMDM-8YpWCchi.js";import{m as Ne}from"./chunk-QY5NICTW-4LiwpMYQ.js";import{b as W}from"./chunk-DBLREEYE-CtPbsGHj.js";import"./chunk-2PIR7DFM-CbcDDgM_.js";import"./chunk-N2KXC5ZE-DfxA9TNT.js";import"./chunk-YRZGWF2W-B425fH_I.js";import"./useHover-Cn_Qs2ce.js";import"./chunk-XHQUSKIE-CRTs_YlA.js";import"./VisuallyHidden-1S0x7PuW.js";import"./useControlledState-ooh80znK.js";import"./index-CvgPtDyB.js";import"./index-DlIxkoSw.js";import"./useFormValidationState-p9Ei66cx.js";import"./chunk-IXXDDLGU-HU1QgMOq.js";import"./useLabels-tDIuDQ55.js";import"./chunk-NK4BRF7C-dghsNpkO.js";import"./index-DJhsGy01.js";import"./Icon-Yd2M5erF.js";import"./PumpStatus-5SYFXcQO.js";import"./chunk-J333S7JQ-CwmjM8Ow.js";import"./index-C4dpBN_I.js";import"./chunk-6NL67ZRH-CDLHZ7fz.js";const je=[{label:"CLEAR",color:"primary",onClick:"handleClear"},{label:"VOID",color:"danger",onClick:"handleVoid"},{label:"VOID ALL",color:"primary",onClick:"handleVoidAll"},{label:"REFRESH",color:"primary",onClick:()=>window.location.reload()},{label:"OPEN DRAWER",color:"primary",className:"md:text-sm"},{label:"SUB-TOTAL",color:"primary",onClick:"handleSubTotal"},{label:"PRINT RECEIPT",color:"primary",className:"md:text-sm",onClick:"handlePrintReceipt"},{label:"ZERO RATED",color:"primary"},{label:"PG DISC",color:"primary"},{label:"CUSTOMER INFO",color:"primary",className:"md:text-sm",onClick:"handleOpenCustomerDetails"},{label:"ALL STOP",color:"primary",onClick:"handleStopAllPumps"},{label:"ALL AUTH",color:"primary",onClick:"handleAuthorizeAllPumps"}];function rt(){const[m,n]=r.useState(""),[p,C]=r.useState([]),[I,w]=r.useState([]),[i,g]=r.useState(()=>{const t=localStorage.getItem("deliveryData");return t?JSON.parse(t):[]}),[l,T]=r.useState(null),[D,k]=r.useState(!1),[R,K]=r.useState(!1),h=r.useRef(null),[O,F]=r.useState([]),[S,v]=r.useState(0),[Ce,Y]=r.useState(!1),[Ie,Z]=r.useState(0),[q,M]=r.useState(!1),[b,z]=r.useState(""),[y,L]=r.useState(""),[N,V]=r.useState(""),[j,U]=r.useState(""),Q=()=>{M(!0)},B=()=>{M(!1)},X=()=>{z(""),L(""),V(""),U(""),B()},ee=t=>{g(s=>{const a=[...s,t];return localStorage.setItem("deliveryData",JSON.stringify(a)),a})},te=()=>{n("")},ae=()=>{n(`Subtotal: ₱${u}`)},se=()=>{if(i.length===0){o.error("No transactions to void");return}g([]),localStorage.removeItem("deliveryData"),localStorage.removeItem("disabledIds"),o.success("All transactions voided."),v(0),window.dispatchEvent(new Event("disabledIdsUpdated"))},re=()=>{if(console.log("Selected Row:",l),l!==null){const t=i.filter(d=>d.Delivery_ID!==l);g(t),localStorage.setItem("deliveryData",JSON.stringify(t)),o.success("Transaction voided"),T(null);const s=t.reduce((d,P)=>d+parseFloat(P.Amount||0),0).toFixed(2),a=Math.max(0,S-s).toFixed(2);v(S),n(a);const c=localStorage.getItem("disabledIds");if(c){const d=new Set(JSON.parse(c));d.delete(l),localStorage.setItem("disabledIds",JSON.stringify(Array.from(d))),window.dispatchEvent(new Event("disabledIdsUpdated"))}}else o.error("No transaction selected")},G=()=>{K(!0),window.removeEventListener("click",G)};r.useEffect(()=>{window.addEventListener("click",G);const t=()=>{x.get("/get-pump-status").then(c=>{const d=c.data;C(d);const P=d.some(E=>E.Data.NozzleUp);R&&(P&&!D?(h.current&&(h.current.loop=!0,h.current.play().catch(E=>{console.error("Error playing sound:",E)})),k(!0)):!P&&D&&(h.current&&(h.current.pause(),h.current.currentTime=0),k(!1)))}).catch(c=>{console.error("Error fetching pump status:",c)})},s=()=>{x.get("/get-mop").then(c=>{w(c.data.data)}).catch(c=>{console.error("Error fetching MOP list:",c)})};t(),s();const a=setInterval(t,500);return()=>clearInterval(a)},[D,R]);const oe=t=>{n(s=>s+t),v(s=>s+t)},le=async()=>{try{const t=await x.post("/stop-all-pumps");o.success("All pumps stopped successfully"),console.log("All pumps stopped:",t.data)}catch(t){o.error("Error stopping all pumps"),console.error("Error stopping all pumps:",t)}},H=async t=>{if(!t){o.error("Transaction ID is undefined");return}try{const a=(await x.get(`/print-receipt/${t}`)).data}catch(s){o.error("Error fetching receipt data"),console.error("Error fetching receipt data:",s)}},ne={handleVoid:re,handleVoidAll:se,setInputValue:n,handleClear:te,handleSubTotal:ae,handlePrintReceipt:H,handleStopAllPumps:le,handleOpenCustomerDetails:Q},ce=async t=>{if(console.log("MOP selected:",t),m===""||parseFloat(m.replace("₱","").replace(",",""))<=0){o.error("Please enter an amount before selecting a method of payment.");return}F(t),await ie()},u=i.reduce((t,s)=>t+parseFloat(s.Amount||0),0).toFixed(2),J=u/1.12*.12,A=S-u,ie=async()=>{if(!O){o.error("Please select a method of payment");return}if(i.length===0){o.error("No transactions to save");return}console.log("Customer Name:",b),console.log("Customer Address:",y),console.log("Customer TIN:",N),console.log("Customer Business Style:",j);try{const t=await x.post("/store-transactions",{subtotal:u,taxTotal:J,change:A,mopName:O.MOP_Name.trim(),deliveryIds:i.map(a=>({Delivery_ID:a.Delivery_ID,Pump:a.Pump,Nozzle:a.Nozzle,Volume:a.Volume,Price:a.Price,Amount:a.Amount,FuelGradeName:a.FuelGradeName})),payment:m,customer:{name:b,address:y,tin:N,businessStyle:j}});console.log("Payload:",{subtotal:u,taxTotal:J,change:A,mopName:O.MOP_Name.trim(),deliveryIds:i.map(a=>({Delivery_ID:a.Delivery_ID,Pump:a.Pump,Nozzle:a.Nozzle,Volume:a.Volume,Price:a.Price,Amount:a.Amount,FuelGradeName:a.FuelGradeName})),payment:m,customer:{name:b,address:y,tin:N,businessStyle:j}});const s=t.data.transaction;if(s){o.success("Transaction saved successfully"),Y(!0);const a=u-S;Z(a),a>0?n(`Amount Due: ₱${a.toFixed(2)}`):n(`Change: ₱${Math.abs(a).toFixed(2)}`),F(null),v(0),await H(s)}else o.error("Error retrieving transaction ID")}catch(t){o.error("Error saving transaction"),console.error("Error saving transaction:",t)}};return e.jsxs(e.Fragment,{children:[e.jsx(de,{title:"Home"}),e.jsx("audio",{ref:h,src:"assets/audio/nozzle-status-sound.wav"}),e.jsx(ue,{position:"top-right"}),e.jsx("div",{className:"min-h-screen p-3",children:e.jsx("main",{className:"w-full h-full mx-auto",children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2 lg:gap-4",children:[e.jsxs(_,{className:"flex flex-col h-full p-3",children:[e.jsx("div",{className:"flex-grow",children:e.jsx(pe,{deliveryData:i,setSelectedRow:T,subtotal:u,inputValue:m,change:A})}),e.jsxs(_,{className:"w-full gap-2 p-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{variant:"bordered",label:e.jsx("p",{className:"font-bold",children:"SUBTOTAL"}),size:"lg",value:`₱${u}`,labelPlacement:"outside-left",className:"w-[35%]",classNames:{input:["text-black text-xl font-bold text-right"]},isReadOnly:!0}),e.jsx(f,{variant:"bordered",className:"w-[70%]",classNames:{input:["text-black text-2xl font-bold text-right"]},value:m,isReadOnly:!0,size:"lg"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-1",children:e.jsx(ge,{handleButtonClick:oe,buttons:je,buttonClickHandlers:ne,setInputValue:n})})]})]}),e.jsx(_,{className:"flex items-start gap-4 rounded-lg bg-white p-6 shadow-[0px_14px_34px_0px_rgba(0,0,0,0.08)] ring-1 ring-white/[0.05] lg:pb-10",children:e.jsx("div",{className:"flex w-full flex-col",children:e.jsxs(he,{"aria-label":"Options",fullWidth:!0,children:[e.jsx($,{title:"PUMPS",children:p.length===0?e.jsxs("div",{className:"flex flex-col items-center mt-6",children:[e.jsx(me,{className:"w-12 h-12 text-danger"}),e.jsx("span",{className:"mt-4",children:"No pumps found"})]}):e.jsx("div",{className:"overflow-y-auto max-h-[calc(100vh-200px)] p-2",children:e.jsx("div",{className:"grid grid-cols-4 gap-2",children:p.map(t=>e.jsx(xe,{pump:t,handleAppendDeliveryData:ee},t.Id))})})},"pumps"),e.jsx($,{title:"MOP",children:e.jsx("div",{className:"grid grid-cols-4 gap-4",children:e.jsx(fe,{mopList:I,onSelectMOP:ce})})},"mop")]})})})]})})}),e.jsx(Pe,{isOpen:q,onClose:B,onCustomerDataChange:(t,s)=>{switch(t){case"name":z(s);break;case"address":L(s);break;case"tin":V(s);break;case"businessStyle":U(s);break}},customerName:b,customerAddress:y,customerTIN:N,customerBusinessStyle:j,onSave:X})]})}const Pe=({isOpen:m,onClose:n,onCustomerDataChange:p,customerName:C,customerAddress:I,customerTIN:w,customerBusinessStyle:i,onSave:g})=>e.jsx(Se,{isOpen:m,onOpenChange:n,placement:"top-center",children:e.jsx(ve,{children:()=>e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"flex flex-col gap-1",children:"Enter Customer Information"}),e.jsxs(ye,{children:[e.jsx(f,{autoFocus:!0,label:"Customer Name",variant:"bordered",value:C,onChange:l=>p("name",l.target.value)}),e.jsx(f,{label:"Address",variant:"bordered",value:I,onChange:l=>p("address",l.target.value)}),e.jsx(f,{label:"TIN",variant:"bordered",value:w,onChange:l=>p("tin",l.target.value)}),e.jsx(f,{label:"Business Style",variant:"bordered",value:i,onChange:l=>p("businessStyle",l.target.value)})]}),e.jsxs(Ne,{children:[e.jsx(W,{auto:!0,flat:!0,color:"error",onClick:n,children:"Cancel"}),e.jsx(W,{auto:!0,onClick:g,children:"Save"})]})]})})});export{Pe as CustomerDetails,rt as default};
