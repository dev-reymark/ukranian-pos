import{r as a,j as t,Y as be,c as y,a as Ne,b as ve,d}from"./app-DJ0OCxwK.js";import{P as we,b as je,S as Pe}from"./POSKeyboard-CFvMiQVm.js";import{Q as Oe,X as Ce,G as De,B as n}from"./index-CjPihSUo.js";import Ie from"./MOPCard-5tvm-XkL.js";import{PumpCard as Ee}from"./PumpCard-zIFWhLTc.js";import{CustomerDetails as Te}from"./CustomerDetails-BJXZp5Gz.js";import{PrinterStatus as Me}from"./PrinterStatus-D_444F3t.js";import{GetCashier as Ae}from"./GetCashier-C70ZXMcB.js";import{GetDateTime as _e}from"./GetDateTime-DW6mrmFi.js";import{ThemeSwitcher as Fe}from"./ThemeSwitcher-CKD5WiPK.js";import Re from"./Index-ChKOWB5U.js";import{CardDetails as ze}from"./CardDetails-DNBVPHqk.js";import{SaleWindowTabs as Be}from"./SaleWindowTabs-BZGo19Sl.js";import ke from"./ReportsIndex-CN4UZPvV.js";import{s as Je}from"./chunk-IXXDDLGU-C927SSi6.js";import{i as W}from"./chunk-GQQM5TNQ-P53s9ApC.js";import{t as Le,a as b}from"./chunk-FXLYF44B-CXo7bLYM.js";import"./chunk-DBLREEYE-C6Vwu_wX.js";import"./chunk-2PIR7DFM-CbcDDgM_.js";import"./iconBase-BN3XEKHS.js";import"./index-BOPwCyX4.js";import"./SelectionManager-CiNkBuTg.js";import"./FocusScope-C3BCnoq3.js";import"./scrollIntoView-D_ErU28Z.js";import"./useControlledState-DF6__fTM.js";import"./chunk-44JHHBS2-CWPKxyw1.js";import"./useLabel-BEN_EtuV.js";import"./useLabels-C7uuHIf4.js";import"./useCollator-BqR0K-ta.js";import"./useListState-BnYXW82J.js";import"./index-2TX6XvHX.js";import"./index-3GMhIGNj.js";import"./chunk-P2T5LMDM-BSwoEP5i.js";import"./getScrollParent-CTiUb1E9.js";import"./VisuallyHidden-D0N98OxW.js";import"./PumpDelivery-B3Qbs3Ap.js";import"./chunk-YRZGWF2W-AeXPm49x.js";import"./chunk-KBN3H6OQ-CWXvv_JV.js";import"./useToggleState-BTeDqN7Y.js";import"./useFormReset-Dic5pjzl.js";import"./chunk-CAFRINWI-BTDo8zfp.js";import"./useFormValidationState-cOo1klYh.js";import"./LiveAnnouncer-q_S9a73M.js";import"./useHasTabbableChild-Daxskigl.js";import"./Icon-C3UHRYlP.js";import"./PumpStatus-5SYFXcQO.js";import"./chunk-QXREVWCS-CzOl0UnF.js";import"./chunk-4WFLSIHH-DHr-3Ab-.js";import"./chunk-M3MASYO7-CeYIKs2S.js";import"./chunk-JHUBASYZ-BiB9buEj.js";import"./ElectricJournal-Cu1TpWAi.js";import"./index-EUbz-fhy.js";import"./index-D834aa3t.js";import"./index-X92CTFGl.js";import"./AboutSoftware-CVR7ZnrI.js";import"./ApplicationLogo-ynUf4uBI.js";import"./PriceChange-B4fw-xZt.js";import"./chunk-RUXXUVWM-Dvg1qZRs.js";import"./NumberFormatter-DgUnyrzU.js";import"./index-B3MhTQ63.js";function qt(){const[K,Ge]=a.useState([]),[N,c]=a.useState(""),[C,Q]=a.useState([]),[X,q]=a.useState([]),[Z,p]=a.useState(!1),[u,v]=a.useState(()=>{const e=localStorage.getItem("deliveryData");return e?JSON.parse(e):[]}),[h,D]=a.useState(null),[w,I]=a.useState(!1),[E,ee]=a.useState(!1),m=a.useRef(null),[T,Ue]=a.useState([]),[M,j]=a.useState(0),[te,se]=a.useState(!1),[$e,ae]=a.useState(0),[re,A]=a.useState(!1),[_,F]=a.useState(""),[R,z]=a.useState(""),[B,k]=a.useState(""),[J,L]=a.useState(""),[g,G]=a.useState(""),[x,U]=a.useState(""),[S,$]=a.useState(""),oe=async()=>{if((await Pe.fire({title:"Are you sure?",text:"You are about to log out and you won't be able to recover this session!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, log out!"})).isConfirmed)try{await d.post("/logout"),window.location.href="/"}catch(s){console.error("Error logging out:",s)}},ne=()=>{A(!0)},H=()=>{A(!1)},le=()=>{H()},ie=e=>{v(s=>{const l=[...s,e];return localStorage.setItem("deliveryData",JSON.stringify(l)),l})},ce=()=>{c("")},de=()=>{c(`Subtotal: ₱${f}`)},me=()=>{if(u.length===0){n.error("No transactions to void");return}v([]),localStorage.removeItem("transaction"),localStorage.removeItem("deliveryData"),localStorage.removeItem("disabledIds"),n.success("All transactions voided."),j(0),c(""),window.dispatchEvent(new Event("disabledIdsUpdated"))},pe=()=>{if(console.log("Selected Row:",h),h!==null){const e=u.filter(o=>o.Delivery_ID!==h);v(e),localStorage.setItem("deliveryData",JSON.stringify(e)),n.success("Transaction voided"),D(null);const s=e.reduce((o,i)=>o+parseFloat(i.Amount||0),0).toFixed(2),l=Math.max(0,M-s).toFixed(2);j(M),c(l);const r=localStorage.getItem("disabledIds");if(r){const o=new Set(JSON.parse(r));o.delete(h),localStorage.setItem("disabledIds",JSON.stringify(Array.from(o))),window.dispatchEvent(new Event("disabledIdsUpdated"))}}else n.error("No transaction selected")},V=()=>{ee(!0),window.removeEventListener("click",V)};a.useEffect(()=>{window.addEventListener("click",V);const e=()=>{d.get("/get-pump-status").then(r=>{const o=r.data;Q(o);const i=o.some(O=>O.Data.NozzleUp);E&&(i&&!w?(m.current&&(m.current.loop=!0,m.current.play().catch(O=>{console.error("Error playing sound:",O)})),I(!0)):!i&&w&&(m.current&&(m.current.pause(),m.current.currentTime=0),I(!1)))}).catch(r=>{console.error("Error fetching pump status:",r)})},s=()=>{d.get("/get-mop").then(r=>{q(r.data.data);const o=K.some(i=>i.MOP_Ref==="3");p(o)}).catch(r=>{console.error("Error fetching MOP list:",r)})};e(),s();const l=setInterval(e,500);return()=>clearInterval(l)},[w,E]);const ue=e=>{c(s=>s+e),j(s=>s+e)},fe=async()=>{try{const e=await d.post("/stop-all-pumps");n.success("All pumps stopped successfully"),console.log("All pumps stopped:",e.data)}catch(e){n.error("Error stopping all pumps"),console.error("Error stopping all pumps:",e)}},he=async()=>{try{const e={Type:"FullTank"},s=await d.post("/authorize-all-pumps",e);n.success("All pumps authorized successfully"),console.log("All pumps authorized:",s.data)}catch(e){n.error("Error authorizing all pumps"),console.error("Error authorizing all pumps:",e)}},Y=async e=>{if(!e){n.error("Transaction ID is undefined");return}try{const l=(await d.get(`/print-receipt/${e}`)).data}catch(s){n.error("Error fetching receipt data"),console.error("Error fetching receipt data:",s)}},ge={handleLogout:oe,handleVoid:pe,handleVoidAll:me,setInputValue:c,handleClear:ce,handleSubTotal:de,handlePrintReceipt:Y,handleStopAllPumps:fe,handleAuthorizeAllPumps:he,handleOpenCustomerDetails:ne,handleOpenDrawer:async()=>{try{const e=await d.get("/open-cash-drawer");n.success("Drawer opened successfully"),console.log("Drawer opened:",e.data)}catch(e){n.error("Error opening drawer"),console.error("Error opening drawer:",e.response?e.response.data:e.message)}}},xe=async e=>{console.log("MOP selected:",e);const s=parseFloat(N.replace("₱","").replace(",",""));if(N===""||s<=0){n.error("Please enter an amount before selecting a method of payment.");return}const l=JSON.parse(localStorage.getItem("transaction"))||{subtotal:parseFloat(f),payments:[],remainingBalance:parseFloat(f)},r=l.remainingBalance-s;if(r>=0)l.payments.push({mopName:e.MOP_Name,amount:s}),l.remainingBalance=r,localStorage.setItem("transaction",JSON.stringify(l)),e.MOP_Ref==="3"?p(!0):r===0?await P():c(`Amount Due: ₱${r.toFixed(2)}`);else{const o=Math.abs(r).toFixed(2);n.success(`Change: ₱${o}`),l.payments.push({mopName:e.MOP_Name,amount:s}),l.remainingBalance=0,localStorage.setItem("transaction",JSON.stringify(l)),c(`Change: ₱${o}`),c(`Change: ₱${o}`),e.MOP_Ref==="3"?p(!0):await P()}},f=u.reduce((e,s)=>e+parseFloat(s.Amount||0),0).toFixed(2),[Se,ye]=a.useState({change:0,mopNames:[],mopPayments:[]}),P=async()=>{const e=JSON.parse(localStorage.getItem("transaction"));if(!e){n.error("No transaction data found");return}if(T&&T.MOP_Ref==="3"&&(!g||!x||!S)){n.error("Please provide complete card details."),p(!0);return}const s=e.payments.reduce((r,o)=>r+o.amount,0),l=Math.max(0,s-e.subtotal).toFixed(2);try{const o=(await d.post("/store-transactions",{subtotal:e.subtotal,taxTotal:e.subtotal/1.12*.12,change:parseFloat(l),mopNames:e.payments.map(i=>i.mopName.trim()),mopPayments:e.payments,deliveryIds:u.map(i=>({Delivery_ID:i.Delivery_ID,Pump:i.Pump,Nozzle:i.Nozzle,Volume:i.Volume,Price:i.Price,Amount:i.Amount,FuelGradeName:i.FuelGradeName})),customer:{name:_,address:R,tin:B,businessStyle:J},cardDetails:{name:S,code:x,number:g}})).data.transaction;o?(localStorage.setItem("transactionId",o),n.success("Transaction saved successfully"),se(!0),ae(0),c("Transaction Complete"),ye({change:parseFloat(l),mopNames:e.payments.map(i=>i.mopName),mopPayments:e.payments}),localStorage.removeItem("transaction"),G(""),U(""),$(""),Y(o)):n.error("Error retrieving transaction ID")}catch(r){n.error("Error saving transaction"),console.error("Error saving transaction:",r)}};return t.jsxs(t.Fragment,{children:[t.jsx(be,{title:"Home"}),t.jsx("audio",{ref:m,src:"assets/audio/nozzle-status-sound.wav"}),t.jsxs("main",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 p-2 h-[100vh]",children:[t.jsxs(y,{className:"dark:bg-gray-900 p-2",children:[t.jsx("div",{className:"flex-none",children:t.jsxs(y,{className:"max-w-full h-full",children:[t.jsxs(Ne,{className:"justify-between",children:[t.jsx(Ae,{}),t.jsx(_e,{})]}),t.jsx(ve,{className:"justify-between",children:t.jsxs("div",{className:"flex gap-4",children:[t.jsx("div",{className:"w-[70%] h-[70px] bg-slate-200 rounded-lg shadow-sm relative",children:t.jsx(Oe,{position:"top-right",autoClose:2e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!1,theme:"light",transition:Ce,style:{position:"absolute",top:0,right:0,bottom:0,left:0,width:"100%",height:"50%"}})}),t.jsx(Me,{}),t.jsx(Fe,{})]})})]})}),t.jsx(Je,{y:3}),t.jsx("div",{className:"flex-grow",children:t.jsx(Be,{deliveryData:u,setSelectedRow:D,subtotal:f,transactionSaved:te,transactionSummary:Se})}),t.jsx("div",{className:"flex-none",children:t.jsxs(y,{className:"w-full gap-2 p-2",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx(W,{variant:"bordered",label:t.jsx("p",{className:"font-bold text-xl",children:"SUBTOTAL"}),size:"lg",value:`₱${f}`,labelPlacement:"outside-left",className:"w-[40%]",classNames:{input:["text-black text-xl font-bold text-right"]},isReadOnly:!0}),t.jsx(W,{variant:"bordered",className:"w-[60%]",classNames:{input:["text-black text-2xl font-bold text-right"]},value:N,isReadOnly:!0,size:"lg"})]}),t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-1",children:t.jsx(we,{handleButtonClick:ue,buttons:je,buttonClickHandlers:ge,setInputValue:c})})]})})]}),t.jsx(y,{className:"dark:bg-gray-900 p-2",children:t.jsx("div",{className:"flex w-full flex-col",children:t.jsxs(Le,{"aria-label":"Pumps",fullWidth:!0,children:[t.jsx(b,{title:t.jsx("p",{className:"font-extrabold",children:"PUMPS"}),children:t.jsx(a.Suspense,{fallback:t.jsx("div",{children:"Loading..."}),children:C.length===0?t.jsxs("div",{className:"col-span-4 flex flex-col items-center justify-center py-12 text-xl font-extrabold text-center text-red-500",children:[t.jsx(De,{className:"text-7xl"}),t.jsx("p",{children:"No pumps connected!"})]}):t.jsx("div",{className:"overflow-y-auto scrollbar-hide max-h-screen p-1",children:t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2",children:C.map(e=>t.jsx(Ee,{pump:e,handleAppendDeliveryData:ie},e.Id))})})})},"pumps"),t.jsx(b,{title:t.jsx("p",{className:"font-extrabold",children:"MOP"}),children:t.jsx(Ie,{mopList:X,onSelectMOP:xe})},"mop"),t.jsx(b,{title:t.jsx("p",{className:"font-extrabold",children:"REPORTS"}),children:t.jsx(ke,{})},"reports"),t.jsx(b,{title:t.jsx("p",{className:"font-extrabold",children:"CONFIG"}),children:t.jsx(Re,{})},"config")]})})})]}),t.jsx(Te,{isOpen:re,onClose:H,onCustomerDataChange:(e,s)=>{switch(e){case"name":F(s);break;case"address":z(s);break;case"tin":k(s);break;case"businessStyle":L(s);break}},customerName:_,customerAddress:R,customerTIN:B,customerBusinessStyle:J,onSave:le,setCustomerName:F,setCustomerAddress:z,setCustomerTIN:k,setCustomerBusinessStyle:L}),t.jsx(ze,{isOpen:Z,onOpenChange:p,cardNumber:g,setCardNumber:G,approvalCode:x,setApprovalCode:U,cardHolderName:S,setCardHolderName:$,onSave:async()=>{if(!g||!x||!S){n.error("Please fill in all card details.");return}p(!1),await P()}})]})}export{qt as default};
