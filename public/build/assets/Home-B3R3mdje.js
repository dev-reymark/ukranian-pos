import{r,j as t,Y as Ne,a as m}from"./app-CG3hSCCP.js";import{S as be}from"./sweetalert2.all-BvbZxT3j.js";import{Q as we,X as je,G as Pe,B as l}from"./index-JM9jNdwV.js";import Oe from"./MOPCard-CbYgKfTK.js";import De,{buttons as Ce}from"./POSKeyboard-tkZVPNsQ.js";import{PumpCard as Ie}from"./PumpCard-D0bNqDpe.js";import{CustomerDetails as Ae}from"./CustomerDetails-CNZroYxz.js";import{PrinterStatus as _e}from"./PrinterStatus-AxnLUmHn.js";import{GetCashier as Fe}from"./GetCashier-DzrWG93L.js";import{GetDateTime as Ee}from"./GetDateTime-JSbjFobY.js";import{ThemeSwitcher as Te}from"./ThemeSwitcher-D9T0mecQ.js";import Me from"./Index-CMOi7o2k.js";import{CardDetails as Re}from"./CardDetails-B9R-7llb.js";import ke from"./SaleWindowTabs-DQa1OPIt.js";import ze from"./ReportsIndex-zizMS08b.js";import{c as v}from"./chunk-H4VOEXHF-CGkO2XOs.js";import{c as Be}from"./chunk-J333S7JQ-BhlAOaIT.js";import{c as Je}from"./chunk-5ALFRFZW-AcYRgPLA.js";import{s as Le}from"./chunk-IXXDDLGU-MaXzxtdl.js";import{i as W}from"./chunk-GQQM5TNQ-rAry1ocd.js";import{t as Ge,a as N}from"./chunk-FXLYF44B-C38Pb3mE.js";import"./iconBase-GnkKZY1p.js";import"./index-D4o97pR2.js";import"./chunk-N2KXC5ZE-Bb84iJeV.js";import"./chunk-XHQUSKIE-B4ClOMq7.js";import"./chunk-RJKRL3AU-CjtrMR1U.js";import"./useFocusable-DuzB0xKt.js";import"./SelectionManager-DkK4sEHF.js";import"./FocusScope-CpJfrh8k.js";import"./useControlledState-BgNZymqW.js";import"./chunk-44JHHBS2-B1bEk4zQ.js";import"./useLabel-Q8XoHhOL.js";import"./useLabels-DmjHiA4o.js";import"./index-Bvk2_Kd_.js";import"./index-DLPbFJSg.js";import"./useListState-DM8uU8-F.js";import"./chunk-RQNQ5XFG-Dn3p-Hil.js";import"./index-rgXass5n.js";import"./chunk-P2T5LMDM-D2ibxJIr.js";import"./getScrollParent-s3uJ6ChY.js";import"./VisuallyHidden-DpkvVz1I.js";import"./chunk-6NL67ZRH-DnhZYCk-.js";import"./chunk-DBLREEYE-BLo6wnq6.js";import"./chunk-2PIR7DFM-CbcDDgM_.js";import"./PumpDelivery-DKYkkHoC.js";import"./chunk-YRZGWF2W-C9fHprA-.js";import"./useToggleState-DLn7htiY.js";import"./useFormReset-DTEM-02-.js";import"./chunk-CAFRINWI-BTDo8zfp.js";import"./useFormValidationState-v1uMEGqz.js";import"./useHasTabbableChild-CFh5_NKW.js";import"./Icon-DCe0_j8J.js";import"./PumpStatus-5SYFXcQO.js";import"./index-BVszRs1M.js";import"./chunk-4WFLSIHH-Ba8tPOwg.js";import"./index-BQmDfF-l.js";import"./chunk-M3MASYO7-DjKVYsRL.js";import"./chunk-JHUBASYZ-BOktjFRo.js";import"./ElectricJournal-C66ayerp.js";import"./index-X92CTFGl.js";import"./AboutSoftware-CEe3qECk.js";import"./ApplicationLogo-052QuPIh.js";import"./chunk-NK4BRF7C-DU22iIEw.js";function aa(){const[K,Ue]=r.useState([]),[b,c]=r.useState(""),[D,Q]=r.useState([]),[X,q]=r.useState([]),[Z,f]=r.useState(!1),[u,h]=r.useState(()=>{const e=localStorage.getItem("deliveryData");return e?JSON.parse(e):[]}),[d,C]=r.useState(null),[w,I]=r.useState(!1),[A,ee]=r.useState(!1),p=r.useRef(null),[_,Ve]=r.useState([]),[F,j]=r.useState(0),[te,ae]=r.useState(!1),[$e,se]=r.useState(0),[oe,E]=r.useState(!1),[T,M]=r.useState(""),[R,k]=r.useState(""),[z,B]=r.useState(""),[J,L]=r.useState(""),[x,G]=r.useState(""),[S,U]=r.useState(""),[y,V]=r.useState(""),re=async()=>{if((await be.fire({title:"Are you sure?",text:"You are about to log out and you won't be able to recover this session!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, log out!"})).isConfirmed)try{await m.post("/logout"),window.location.href="/"}catch(a){console.error("Error logging out:",a)}},ne=()=>{E(!0)},$=()=>{E(!1)},le=()=>{$()},ie=e=>{h(a=>{const i=[...a,e];return localStorage.setItem("deliveryData",JSON.stringify(i)),i})},ce=()=>{c("")},de=()=>{c(`Subtotal: ₱${g}`)},me=()=>{if(u.length===0){l.error("No transactions to void");return}h([]),localStorage.removeItem("transaction"),localStorage.removeItem("deliveryData"),localStorage.removeItem("disabledIds"),l.success("All transactions voided."),j(0),c(""),window.dispatchEvent(new Event("disabledIdsUpdated"))},ue=()=>{if(console.log("Selected Row:",d),d!==null){const e=u.filter(o=>o.Delivery_ID!==d);h(e),localStorage.setItem("deliveryData",JSON.stringify(e)),l.success("Transaction voided"),C(null);const a=e.reduce((o,n)=>o+parseFloat(n.Amount||0),0).toFixed(2),i=Math.max(0,F-a).toFixed(2);j(F),c(i);const s=localStorage.getItem("disabledIds");if(s){const o=new Set(JSON.parse(s));o.delete(d),localStorage.setItem("disabledIds",JSON.stringify(Array.from(o))),window.dispatchEvent(new Event("disabledIdsUpdated"))}}else l.error("No transaction selected")},H=()=>{ee(!0),window.removeEventListener("click",H)};r.useEffect(()=>{window.addEventListener("click",H);const e=()=>{m.get("/get-pump-status").then(s=>{const o=s.data;Q(o);const n=o.some(O=>O.Data.NozzleUp);A&&(n&&!w?(p.current&&(p.current.loop=!0,p.current.play().catch(O=>{console.error("Error playing sound:",O)})),I(!0)):!n&&w&&(p.current&&(p.current.pause(),p.current.currentTime=0),I(!1)))}).catch(s=>{console.error("Error fetching pump status:",s)})},a=()=>{m.get("/get-mop").then(s=>{q(s.data.data);const o=K.some(n=>n.MOP_Ref==="3");f(o)}).catch(s=>{console.error("Error fetching MOP list:",s)})};e(),a();const i=setInterval(e,500);return()=>clearInterval(i)},[w,A]);const pe=e=>{c(a=>a+e),j(a=>a+e)},fe=async()=>{try{const e=await m.post("/stop-all-pumps");l.success("All pumps stopped successfully"),console.log("All pumps stopped:",e.data)}catch(e){l.error("Error stopping all pumps"),console.error("Error stopping all pumps:",e)}},ge=async()=>{try{const e={Type:"FullTank"},a=await m.post("/authorize-all-pumps",e);l.success("All pumps authorized successfully"),console.log("All pumps authorized:",a.data)}catch(e){l.error("Error authorizing all pumps"),console.error("Error authorizing all pumps:",e)}},Y=async e=>{if(!e){l.error("Transaction ID is undefined");return}try{const i=(await m.get(`/print-receipt/${e}`)).data}catch(a){l.error("Error fetching receipt data"),console.error("Error fetching receipt data:",a)}},he={handleLogout:re,handleVoid:ue,handleVoidAll:me,setInputValue:c,handleClear:ce,handleSubTotal:de,handlePrintReceipt:Y,handleStopAllPumps:fe,handleAuthorizeAllPumps:ge,handleOpenCustomerDetails:ne,handleOpenDrawer:async()=>{try{const e=await m.get("/open-cash-drawer");l.success("Drawer opened successfully"),console.log("Drawer opened:",e.data)}catch(e){l.error("Error opening drawer"),console.error("Error opening drawer:",e.response?e.response.data:e.message)}}},xe=async e=>{console.log("MOP selected:",e);const a=parseFloat(b.replace("₱","").replace(",",""));if(b===""||a<=0){l.error("Please enter an amount before selecting a method of payment.");return}const i=JSON.parse(localStorage.getItem("transaction"))||{subtotal:parseFloat(g),payments:[],remainingBalance:parseFloat(g)},s=i.remainingBalance-a;if(s>=0)i.payments.push({mopName:e.MOP_Name,amount:a}),i.remainingBalance=s,localStorage.setItem("transaction",JSON.stringify(i)),e.MOP_Ref==="3"?f(!0):s===0?await P():c(`Amount Due: ₱${s.toFixed(2)}`);else{const o=Math.abs(s).toFixed(2);l.success(`Change: ₱${o}`),i.payments.push({mopName:e.MOP_Name,amount:a}),i.remainingBalance=0,localStorage.setItem("transaction",JSON.stringify(i)),c(`Change: ₱${o}`),c(`Change: ₱${o}`),e.MOP_Ref==="3"?f(!0):await P()}},g=u.reduce((e,a)=>e+parseFloat(a.Amount||0),0).toFixed(2),[Se,ye]=r.useState({change:0,mopNames:[],mopPayments:[],deliveryData:[]}),ve=(e,a)=>{if(d==null){l.error("Please select an item to apply discount");return}if(e.discount_id>=1&&e.discount_id<=4){l.info("Discount not applicable");return}console.log("Selected Row:",d),console.log("Selected Discount:",e),console.log("Selected Preset:",a);const i=u.map(s=>{if(s.Delivery_ID===d){let o=0;switch(console.log("Selected Discount Type:",e==null?void 0:e.discount_type),console.log("Preset Value:",a==null?void 0:a.preset_value),e==null?void 0:e.discount_type){case"1":o=parseFloat(s.Amount)*parseFloat(a==null?void 0:a.preset_value)/100;break;case"2":o=parseFloat(s.Volume)*parseFloat(a==null?void 0:a.preset_value);break;case"3":o=parseFloat(a==null?void 0:a.preset_value);break}console.log("Calculated Discount Amount:",o);const n=parseFloat(s.Amount)-o;return{...s,OriginalAmount:s.Amount,Amount:n.toFixed(2),DiscountedAmount:o.toFixed(2),PresetName:a==null?void 0:a.preset_name}}return s});h(i),l.success("Discount applied.")},P=async()=>{const e=JSON.parse(localStorage.getItem("transaction"));if(!e){l.error("No transaction data found");return}if(_&&_.MOP_Ref==="3"&&(!x||!S||!y)){l.error("Please provide complete card details."),f(!0);return}const a=e.payments.reduce((s,o)=>s+o.amount,0),i=Math.max(0,a-e.subtotal).toFixed(2);try{const o=(await m.post("/store-transactions",{subtotal:e.subtotal,taxTotal:e.subtotal/1.12*.12,change:parseFloat(i),mopNames:e.payments.map(n=>n.mopName.trim()),mopPayments:e.payments,deliveryIds:u.map(n=>({Delivery_ID:n.Delivery_ID,Pump:n.Pump,Nozzle:n.Nozzle,Volume:n.Volume,Price:n.Price,Amount:n.Amount,OriginalAmount:n.OriginalAmount,DiscountedAmount:n.DiscountedAmount,PresetName:n.PresetName,FuelGradeName:n.FuelGradeName})),customer:{name:T,address:R,tin:z,businessStyle:J},cardDetails:{name:y,code:S,number:x}})).data.transaction;o?(localStorage.setItem("transactionId",o),l.success("Transaction saved successfully"),ae(!0),se(0),c("Transaction Complete"),ye({change:parseFloat(i),mopNames:e.payments.map(n=>n.mopName),mopPayments:e.payments,deliveryData:u}),localStorage.removeItem("transaction"),G(""),U(""),V(""),Y(o)):l.error("Error retrieving transaction ID")}catch(s){l.error("Error saving transaction"),console.error("Error saving transaction:",s)}};return t.jsxs(t.Fragment,{children:[t.jsx(Ne,{title:"Home"}),t.jsx("audio",{ref:p,src:"assets/audio/nozzle-status-sound.wav"}),t.jsxs("main",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 p-2 h-[100vh]",children:[t.jsxs(v,{className:"dark:bg-gray-900 p-2",children:[t.jsx("div",{className:"flex-none",children:t.jsxs(v,{className:"max-w-full h-full",children:[t.jsxs(Be,{className:"justify-between",children:[t.jsx(Fe,{}),t.jsx(Ee,{})]}),t.jsx(Je,{className:"justify-between",children:t.jsxs("div",{className:"flex gap-4",children:[t.jsx("div",{className:"w-[70%] h-[70px] bg-slate-200 rounded-lg shadow-sm relative",children:t.jsx(we,{position:"top-right",autoClose:2e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!1,theme:"light",transition:je,style:{position:"absolute",top:0,right:0,bottom:0,left:0,width:"100%",height:"50%"}})}),t.jsx(_e,{}),t.jsx(Te,{})]})})]})}),t.jsx(Le,{y:3}),t.jsx("div",{className:"flex-grow",children:t.jsx(ke,{deliveryData:u,setSelectedRow:C,subtotal:g,transactionSaved:te,transactionSummary:Se})}),t.jsx("div",{className:"flex-none",children:t.jsxs(v,{className:"w-full gap-2 p-2",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx(W,{variant:"bordered",label:t.jsx("p",{className:"font-bold text-xl",children:"SUBTOTAL"}),size:"lg",value:`₱${g}`,labelPlacement:"outside-left",className:"w-[40%]",classNames:{input:["text-black text-xl font-bold text-right"]},isReadOnly:!0}),t.jsx(W,{variant:"bordered",className:"w-[60%]",classNames:{input:["text-black text-2xl font-bold text-right"]},value:b,isReadOnly:!0,size:"lg"})]}),t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-1",children:t.jsx(De,{handleButtonClick:pe,buttons:Ce,buttonClickHandlers:he,setInputValue:c})})]})})]}),t.jsx(v,{className:"dark:bg-gray-900 p-2",children:t.jsx("div",{className:"flex w-full flex-col",children:t.jsxs(Ge,{"aria-label":"Pumps",fullWidth:!0,children:[t.jsx(N,{title:t.jsx("p",{className:"font-extrabold",children:"PUMPS"}),children:t.jsx(r.Suspense,{fallback:t.jsx("div",{children:"Loading..."}),children:D.length===0?t.jsxs("div",{className:"col-span-4 flex flex-col items-center justify-center py-12 text-xl font-extrabold text-center text-red-500",children:[t.jsx(Pe,{className:"text-7xl"}),t.jsx("p",{children:"No pumps connected!"})]}):t.jsx("div",{className:"overflow-y-auto scrollbar-hide max-h-screen p-1",children:t.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2",children:D.map(e=>t.jsx(Ie,{pump:e,handleAppendDeliveryData:ie},e.Id))})})})},"pumps"),t.jsx(N,{title:t.jsx("p",{className:"font-extrabold",children:"MOP"}),children:t.jsx(Oe,{mopList:X,onSelectMOP:xe,onApplyDiscount:ve})},"mop"),t.jsx(N,{title:t.jsx("p",{className:"font-extrabold",children:"REPORTS"}),children:t.jsx(ze,{})},"reports"),t.jsx(N,{title:t.jsx("p",{className:"font-extrabold",children:"CONFIG"}),children:t.jsx(Me,{})},"config")]})})})]}),t.jsx(Ae,{isOpen:oe,onClose:$,onCustomerDataChange:(e,a)=>{switch(e){case"name":M(a);break;case"address":k(a);break;case"tin":B(a);break;case"businessStyle":L(a);break}},customerName:T,customerAddress:R,customerTIN:z,customerBusinessStyle:J,onSave:le,setCustomerName:M,setCustomerAddress:k,setCustomerTIN:B,setCustomerBusinessStyle:L}),t.jsx(Re,{isOpen:Z,onOpenChange:f,cardNumber:x,setCardNumber:G,approvalCode:S,setApprovalCode:U,cardHolderName:y,setCardHolderName:V,onSave:async()=>{if(!x||!S||!y){l.error("Please fill in all card details.");return}f(!1),await P()}})]})}export{aa as default};
