import{r,j as t,Y,a as u}from"./app-B4BG-zsf.js";import{F as Z}from"./PumpDelivery-DIyMvjHg.js";import{I as q,_ as o}from"./index-CTtetcYR.js";import{S as Q,t as X,a as R}from"./SaleWindowTabs-B0HiIsOn.js";import ee from"./MOPCard-DjXVUPoE.js";import te from"./POSKeyboard-C_7q9RfO.js";import ae from"./PumpCard-SjIomj3f.js";import{c as N}from"./chunk-H4VOEXHF-KXDKSMRY.js";import{i as T}from"./chunk-GQQM5TNQ-MgHbtYIT.js";import"./chunk-2PIR7DFM-CbcDDgM_.js";import"./chunk-N2KXC5ZE-BW_RAGKI.js";import"./chunk-YRZGWF2W-Ipl9dw3b.js";import"./useHover-BpzbR3dc.js";import"./chunk-XHQUSKIE-DypDiBrP.js";import"./index-D74cUTvv.js";import"./index-pdR8Wy-p.js";import"./useControlledState-8q6f39f1.js";import"./chunk-IXXDDLGU-YwwyhbHd.js";import"./chunk-DBLREEYE-BMCo4_kI.js";import"./index-Bz6CY5HX.js";import"./chunk-6NL67ZRH-C8eIUKNI.js";import"./useLabels-QLp2ZEbS.js";import"./Icon-DJHGUTBe.js";import"./PumpStatus-5SYFXcQO.js";import"./index-BCtTUkCw.js";import"./chunk-P2T5LMDM-D_p1vvn2.js";const se=[{label:"CLEAR",color:"primary",onClick:"handleClear"},{label:"VOID",color:"danger",onClick:"handleVoid"},{label:"VOID ALL",color:"primary",onClick:"handleVoidAll"},{label:"REFRESH",color:"primary",onClick:()=>window.location.reload()},{label:"OPEN DRAWER",color:"primary",className:"md:text-sm"},{label:"SUB-TOTAL",color:"primary"},{label:"PRINT RECEIPT",color:"primary",className:"md:text-sm",onClick:"handlePrintReceipt"},{label:"ZERO RATED",color:"primary"},{label:"PG DISC",color:"primary"},{label:"ENTER",color:"primary"},{label:"ALL STOP",color:"primary",onClick:"handleStopAllPumps"},{label:"ALL AUTH",color:"primary",onClick:"handleAuthorizeAllPumps"}];function Te(){const[f,i]=r.useState(""),[P,C]=r.useState([]),[_,F]=r.useState([]);r.useState([]);const[d,g]=r.useState(()=>{const e=localStorage.getItem("deliveryData");return e?JSON.parse(e):[]}),[h,w]=r.useState(null),[S,I]=r.useState(!1),[j,L]=r.useState(!1),c=r.useRef(null),[D,y]=r.useState([]),[x,m]=r.useState(0),[re,M]=r.useState(!1),[oe,k]=r.useState(0),z=e=>{g(s=>{const a=[...s,e];return localStorage.setItem("deliveryData",JSON.stringify(a)),a})},U=()=>{i(""),m(0),localStorage.removeItem("deliveryData"),g([]),y(null)},V=()=>{if(d.length===0){o.error("No transactions to void");return}g([]),localStorage.removeItem("deliveryData"),localStorage.removeItem("disabledIds"),o.success("All transactions voided successfully"),m(0),window.dispatchEvent(new Event("disabledIdsUpdated"))},B=()=>{if(console.log("Selected Row:",h),h!==null){const e=d.filter(n=>n.Delivery_ID!==h);g(e),localStorage.setItem("deliveryData",JSON.stringify(e)),o.success("Transaction voided successfully"),w(null);const s=e.reduce((n,v)=>n+parseFloat(v.Amount||0),0).toFixed(2),a=Math.max(0,x-s).toFixed(2);m(x),i(a);const l=localStorage.getItem("disabledIds");if(l){const n=new Set(JSON.parse(l));n.delete(h),localStorage.setItem("disabledIds",JSON.stringify(Array.from(n))),window.dispatchEvent(new Event("disabledIdsUpdated"))}}else o.error("No transaction selected")},E=()=>{L(!0),window.removeEventListener("click",E)};r.useEffect(()=>{window.addEventListener("click",E);const e=()=>{u.get("/get-pump-status").then(l=>{const n=l.data;C(n);const v=n.some(b=>b.Data.NozzleUp);j&&(v&&!S?(c.current&&(c.current.loop=!0,c.current.play().catch(b=>{console.error("Error playing sound:",b)})),I(!0)):!v&&S&&(c.current&&(c.current.pause(),c.current.currentTime=0),I(!1)))}).catch(l=>{console.error("Error fetching pump status:",l)})},s=()=>{u.get("/get-mop").then(l=>{F(l.data.data)}).catch(l=>{console.error("Error fetching MOP list:",l)})};e(),s();const a=setInterval(e,500);return()=>clearInterval(a)},[S,j]);const H=e=>{i(s=>s+e),m(s=>s+e)},J=async()=>{try{const e=await u.post("/stop-all-pumps");o.success("All pumps stopped successfully"),console.log("All pumps stopped:",e.data)}catch(e){o.error("Error stopping all pumps"),console.error("Error stopping all pumps:",e)}},A=async e=>{if(!e){o.error("Transaction ID is undefined");return}try{const a=(await u.get(`/print-receipt/${e}`)).data}catch(s){o.error("Error fetching receipt data"),console.error("Error fetching receipt data:",s)}},G={handleVoid:B,handleVoidAll:V,setInputValue:i,handleClear:U,handlePrintReceipt:A,handleStopAllPumps:J},$=async e=>{if(console.log("MOP selected:",e),f===""||parseFloat(f.replace("₱","").replace(",",""))<=0){o.error("Please enter an amount before selecting a method of payment.");return}y(e),await K()},p=d.reduce((e,s)=>e+parseFloat(s.Amount||0),0).toFixed(2),W=p*.12,O=x-p,K=async()=>{if(!D){o.error("Please select a method of payment");return}if(d.length===0){o.error("No transactions to save");return}try{const s=(await u.post("/store-transactions",{subtotal:p,taxTotal:W,change:O,mopName:D.MOP_Name.trim(),deliveryIds:d.map(a=>({Delivery_ID:a.Delivery_ID,Pump:a.Pump,Nozzle:a.Nozzle,Volume:a.Volume,Price:a.Price,Amount:a.Amount,FuelGradeName:a.FuelGradeName}))})).data.transaction;if(s){o.success("Transaction saved successfully"),M(!0);const a=p-x;k(a),a>0?i(`Amount Due: ₱${a.toFixed(2)}`):i(`Change: ₱${Math.abs(a).toFixed(2)}`),y(null),m(0),await A(s)}else o.error("Error retrieving transaction ID")}catch(e){o.error("Error saving transaction"),console.error("Error saving transaction:",e)}};return t.jsxs(t.Fragment,{children:[t.jsx(Y,{title:"Home"}),t.jsx("audio",{ref:c,src:"assets/audio/nozzle-status-sound.wav"}),t.jsx(q,{position:"top-right"}),t.jsx("div",{className:"min-h-screen p-3",children:t.jsx("main",{className:"w-full h-full mx-auto",children:t.jsxs("div",{className:"grid gap-6 lg:grid-cols-2 lg:gap-4",children:[t.jsxs(N,{className:"flex flex-col h-full p-3",children:[t.jsx("div",{className:"flex-grow",children:t.jsx(Q,{deliveryData:d,setSelectedRow:w,change:O,subtotal:p,inputValue:f})}),t.jsxs(N,{className:"w-full gap-2 p-2",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx(T,{variant:"bordered",label:t.jsx("p",{className:"font-bold",children:"SUBTOTAL"}),size:"lg",value:`₱${p}`,labelPlacement:"outside-left",className:"w-[35%]",classNames:{input:["text-black text-xl font-bold text-right"]},isReadOnly:!0}),t.jsx(T,{variant:"bordered",className:"w-[70%]",classNames:{input:["text-black text-2xl font-bold text-right"]},value:f,isReadOnly:!0,size:"lg"})]}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-1",children:t.jsx(te,{handleButtonClick:H,buttons:se,buttonClickHandlers:G,setInputValue:i})})]})]}),t.jsx(N,{className:"flex items-start gap-4 rounded-lg bg-white p-6 shadow-[0px_14px_34px_0px_rgba(0,0,0,0.08)] ring-1 ring-white/[0.05] lg:pb-10",children:t.jsx("div",{className:"flex w-full flex-col",children:t.jsxs(X,{"aria-label":"Options",fullWidth:!0,children:[t.jsx(R,{title:"PUMPS",children:P.length===0?t.jsxs("div",{className:"flex flex-col items-center mt-6",children:[t.jsx(Z,{className:"w-12 h-12 text-danger"}),t.jsx("span",{className:"mt-4",children:"No pumps found"})]}):t.jsx("div",{className:"overflow-y-auto max-h-[calc(100vh-200px)] p-2",children:t.jsx("div",{className:"grid grid-cols-4 gap-2",children:P.map(e=>t.jsx(ae,{pump:e,handleAppendDeliveryData:z},e.Id))})})},"pumps"),t.jsx(R,{title:"MOP",children:t.jsx("div",{className:"grid grid-cols-4 gap-4",children:t.jsx(ee,{mopList:_,onSelectMOP:$})})},"mop")]})})})]})})})]})}export{se as buttons,Te as default};
