import{r as s,j as t,Y as ye,a as p}from"./app-DjTnAJHU.js";import{S as Ne}from"./sweetalert2.all-RnivVnX_.js";import{F as ve}from"./PumpDelivery-D7fKAHFW.js";import{I as be,_ as i}from"./index-D9Vr5c70.js";import we from"./MOPCard-hDGrQV7j.js";import je,{buttons as Pe}from"./POSKeyboard-5MVZMDa0.js";import{PumpCard as Ie}from"./PumpCard-NFC8iVLl.js";import{CustomerDetails as Ce}from"./CustomerDetails-BQi3G5Uk.js";import{PrinterStatus as De}from"./PrinterStatus-sEgGVu4Q.js";import{GetCashier as Oe}from"./GetCashier-CdRIrqm-.js";import{GetDateTime as _e}from"./GetDateTime-D0XW5h9y.js";import{ThemeSwitcher as Me}from"./ThemeSwitcher-BF5dAtfu.js";import Ee from"./Index-CWmVk8Sb.js";import{CardDetails as Te}from"./CardDetails-mZHPgtLu.js";import{S as Fe,t as Ae,a as I}from"./SaleWindowTabs-CaVt_6Wl.js";import{c as y}from"./chunk-H4VOEXHF-PX8WBP7F.js";import{c as Re}from"./chunk-J333S7JQ-CiRF1C-l.js";import{c as Be}from"./chunk-5ALFRFZW-C2zccOvL.js";import{s as ke}from"./chunk-IXXDDLGU-DUqUVKJV.js";import{i as W}from"./chunk-GQQM5TNQ-Baehs0Xq.js";import"./iconBase-Cr6B5MGf.js";import"./chunk-2PIR7DFM-CbcDDgM_.js";import"./chunk-N2KXC5ZE-Kgk3kMjF.js";import"./chunk-YRZGWF2W-Vsb2RKyJ.js";import"./chunk-RQNQ5XFG-COhtj_I3.js";import"./chunk-RJKRL3AU-CjtrMR1U.js";import"./chunk-XHQUSKIE-CUz6w6jd.js";import"./useFocusable-CNXkPjnZ.js";import"./FocusScope-C9UmCj7T.js";import"./useToggleState-DazR7R2g.js";import"./useFormReset-CoyT_xFz.js";import"./useControlledState-C6ntFCXh.js";import"./index-DrwLM0E2.js";import"./index-CsnIy0R2.js";import"./useHover-BCKdp4yL.js";import"./chunk-CAFRINWI-CcU5yOMx.js";import"./useFormValidationState-B8Au1OSJ.js";import"./VisuallyHidden-B8YnK5yi.js";import"./chunk-DBLREEYE-BVMqLuqM.js";import"./index-DJXerKUR.js";import"./chunk-6NL67ZRH-BUc_PyMm.js";import"./chunk-NK4BRF7C-DR0H6arF.js";import"./index-T4SjOrb_.js";import"./chunk-JHUBASYZ-DiAIw8qV.js";import"./Icon-B1IDCcNC.js";import"./PumpStatus-5SYFXcQO.js";import"./chunk-4WFLSIHH-Dw_AiNOK.js";import"./chunk-M3MASYO7-NrIxm53S.js";import"./chunk-P2T5LMDM-DMHJqG4-.js";import"./useLabels-draqUw9I.js";import"./chunk-QY5NICTW-BT3ja2CH.js";import"./ElectricJournal-vblKRKKh.js";import"./index-X92CTFGl.js";import"./chunk-44JHHBS2-B0Y3cujn.js";import"./AboutSoftware-E2HYthLd.js";import"./ApplicationLogo-CeW4WYwW.js";import"./index-B9NzPiMK.js";function Gt(){const[K,ze]=s.useState([]),[N,c]=s.useState(""),[C,q]=s.useState([]),[Q,X]=s.useState([]),[Z,d]=s.useState(!1),[u,v]=s.useState(()=>{const e=localStorage.getItem("deliveryData");return e?JSON.parse(e):[]}),[g,D]=s.useState(null),[b,O]=s.useState(!1),[_,ee]=s.useState(!1),m=s.useRef(null),[M,Je]=s.useState([]),[E,w]=s.useState(0),[te,ae]=s.useState(!1),[Ue,se]=s.useState(0),[re,T]=s.useState(!1),[F,A]=s.useState(""),[R,B]=s.useState(""),[k,z]=s.useState(""),[J,U]=s.useState(""),[h,L]=s.useState(""),[x,$]=s.useState(""),[S,V]=s.useState(""),oe=async()=>{if((await Ne.fire({title:"Are you sure?",text:"You are about to log out and you won't be able to recover this session!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, log out!"})).isConfirmed)try{await p.post("/logout"),window.location.href="/"}catch(a){console.error("Error logging out:",a)}},ne=()=>{T(!0)},G=()=>{T(!1)},le=()=>{G()},ie=e=>{v(a=>{const n=[...a,e];return localStorage.setItem("deliveryData",JSON.stringify(n)),n})},ce=()=>{c("")},me=()=>{c(`Subtotal: ₱${f}`)},de=()=>{if(u.length===0){i.error("No transactions to void");return}v([]),localStorage.removeItem("transaction"),localStorage.removeItem("deliveryData"),localStorage.removeItem("disabledIds"),i.success("All transactions voided."),w(0),c(""),window.dispatchEvent(new Event("disabledIdsUpdated"))},pe=()=>{if(console.log("Selected Row:",g),g!==null){const e=u.filter(o=>o.Delivery_ID!==g);v(e),localStorage.setItem("deliveryData",JSON.stringify(e)),i.success("Transaction voided"),D(null);const a=e.reduce((o,l)=>o+parseFloat(l.Amount||0),0).toFixed(2),n=Math.max(0,E-a).toFixed(2);w(E),c(n);const r=localStorage.getItem("disabledIds");if(r){const o=new Set(JSON.parse(r));o.delete(g),localStorage.setItem("disabledIds",JSON.stringify(Array.from(o))),window.dispatchEvent(new Event("disabledIdsUpdated"))}}else i.error("No transaction selected")},H=()=>{ee(!0),window.removeEventListener("click",H)};s.useEffect(()=>{window.addEventListener("click",H);const e=()=>{p.get("/get-pump-status").then(r=>{const o=r.data;q(o);const l=o.some(P=>P.Data.NozzleUp);_&&(l&&!b?(m.current&&(m.current.loop=!0,m.current.play().catch(P=>{console.error("Error playing sound:",P)})),O(!0)):!l&&b&&(m.current&&(m.current.pause(),m.current.currentTime=0),O(!1)))}).catch(r=>{console.error("Error fetching pump status:",r)})},a=()=>{p.get("/get-mop").then(r=>{X(r.data.data);const o=K.some(l=>l.MOP_Ref==="3");d(o)}).catch(r=>{console.error("Error fetching MOP list:",r)})};e(),a();const n=setInterval(e,500);return()=>clearInterval(n)},[b,_]);const ue=e=>{c(a=>a+e),w(a=>a+e)},fe=async()=>{try{const e=await p.post("/stop-all-pumps");i.success("All pumps stopped successfully"),console.log("All pumps stopped:",e.data)}catch(e){i.error("Error stopping all pumps"),console.error("Error stopping all pumps:",e)}},Y=async e=>{if(!e){i.error("Transaction ID is undefined");return}try{const n=(await p.get(`/print-receipt/${e}`)).data}catch(a){i.error("Error fetching receipt data"),console.error("Error fetching receipt data:",a)}},ge={handleLogout:oe,handleVoid:pe,handleVoidAll:de,setInputValue:c,handleClear:ce,handleSubTotal:me,handlePrintReceipt:Y,handleStopAllPumps:fe,handleOpenCustomerDetails:ne},he=async e=>{console.log("MOP selected:",e);const a=parseFloat(N.replace("₱","").replace(",",""));if(N===""||a<=0){i.error("Please enter an amount before selecting a method of payment.");return}const n=JSON.parse(localStorage.getItem("transaction"))||{subtotal:parseFloat(f),payments:[],remainingBalance:parseFloat(f)},r=n.remainingBalance-a;if(r>=0)n.payments.push({mopName:e.MOP_Name,amount:a}),n.remainingBalance=r,localStorage.setItem("transaction",JSON.stringify(n)),e.MOP_Ref==="3"?d(!0):r===0?await j():c(`Amount Due: ₱${r.toFixed(2)}`);else{const o=Math.abs(r).toFixed(2);i.success(`Payment exceeds the remaining balance. Change: ₱${o}`),n.payments.push({mopName:e.MOP_Name,amount:a}),n.remainingBalance=0,localStorage.setItem("transaction",JSON.stringify(n)),c(`Change: ₱${o}`),c(`Change: ₱${o}`),e.MOP_Ref==="3"?d(!0):await j()}},f=u.reduce((e,a)=>e+parseFloat(a.Amount||0),0).toFixed(2),[xe,Se]=s.useState({change:0,mopNames:[],mopPayments:[]}),j=async()=>{const e=JSON.parse(localStorage.getItem("transaction"));if(!e){i.error("No transaction data found");return}if(M&&M.MOP_Ref==="3"&&(!h||!x||!S)){i.error("Please provide complete card details."),d(!0);return}const a=e.payments.reduce((r,o)=>r+o.amount,0),n=Math.max(0,a-e.subtotal).toFixed(2);try{const o=(await p.post("/store-transactions",{subtotal:e.subtotal,taxTotal:e.subtotal/1.12*.12,change:parseFloat(n),mopNames:e.payments.map(l=>l.mopName.trim()),mopPayments:e.payments,deliveryIds:u.map(l=>({Delivery_ID:l.Delivery_ID,Pump:l.Pump,Nozzle:l.Nozzle,Volume:l.Volume,Price:l.Price,Amount:l.Amount,FuelGradeName:l.FuelGradeName})),customer:{name:F,address:R,tin:k,businessStyle:J},cardDetails:{name:S,code:x,number:h}})).data.transaction;o?(localStorage.setItem("transactionId",o),i.success("Transaction saved successfully"),ae(!0),se(0),c("Transaction Complete"),Se({change:parseFloat(n),mopNames:e.payments.map(l=>l.mopName),mopPayments:e.payments}),localStorage.removeItem("transaction"),L(""),$(""),V(""),Y(o)):i.error("Error retrieving transaction ID")}catch(r){i.error("Error saving transaction"),console.error("Error saving transaction:",r)}};return t.jsxs(t.Fragment,{children:[t.jsx(ye,{title:"Home"}),t.jsx("audio",{ref:m,src:"assets/audio/nozzle-status-sound.wav"}),t.jsx("div",{className:"min-h-screen dark:bg-gray-900 p-3",children:t.jsx("main",{className:"w-full h-full mx-auto",children:t.jsxs("div",{className:"grid gap-6 lg:grid-cols-2 lg:gap-4",children:[t.jsxs(y,{className:"dark:bg-gray-800 flex flex-col h-full p-3",children:[t.jsx("div",{children:t.jsxs(y,{className:"max-w-full",children:[t.jsxs(Re,{className:"justify-between",children:[t.jsx(Oe,{}),t.jsx(_e,{})]}),t.jsx(Be,{className:"justify-between",children:t.jsxs("div",{className:"flex gap-4",children:[t.jsx("div",{className:"w-[70%] bg-slate-200 rounded-lg shadow-sm relative",children:t.jsx(be,{position:"top-right"})}),t.jsx(De,{}),t.jsx(Me,{})]})})]})}),t.jsx(ke,{y:3}),t.jsx("div",{className:"flex-grow",children:t.jsx(Fe,{deliveryData:u,setSelectedRow:D,subtotal:f,transactionSaved:te,transactionSummary:xe})}),t.jsxs(y,{className:"w-full gap-2 p-2",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx(W,{variant:"bordered",label:t.jsx("p",{className:"font-bold text-xl",children:"SUBTOTAL"}),size:"lg",value:`₱${f}`,labelPlacement:"outside-left",className:"w-[40%]",classNames:{input:["text-black text-xl font-bold text-right"]},isReadOnly:!0}),t.jsx(W,{variant:"bordered",className:"w-[60%]",classNames:{input:["text-black text-2xl font-bold text-right"]},value:N,isReadOnly:!0,size:"lg"})]}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-1",children:t.jsx(je,{handleButtonClick:ue,buttons:Pe,buttonClickHandlers:ge,setInputValue:c})})]})]}),t.jsx(y,{className:"dark:bg-gray-800  flex items-start gap-4 rounded-lg bg-white p-6 shadow-[0px_14px_34px_0px_rgba(0,0,0,0.08)] ring-1 ring-white/[0.05] lg:pb-10",children:t.jsx("div",{className:"flex w-full flex-col",children:t.jsxs(Ae,{"aria-label":"Options",fullWidth:!0,children:[t.jsx(I,{title:"PUMPS",children:C.length===0?t.jsxs("div",{className:"flex flex-col items-center mt-6",children:[t.jsx(ve,{className:"w-12 h-12 text-danger"}),t.jsx("span",{className:"mt-4",children:"No pumps found"})]}):t.jsx("div",{className:"overflow-y-auto max-h-[calc(100vh-200px)] p-2",children:t.jsx("div",{className:"grid grid-cols-4 gap-2",children:C.map(e=>t.jsx(Ie,{pump:e,handleAppendDeliveryData:ie},e.Id))})})},"pumps"),t.jsx(I,{title:"MOP",children:t.jsx(we,{mopList:Q,onSelectMOP:he})},"mop"),t.jsx(I,{title:"Config",children:t.jsx(Ee,{})},"config")]})})})]})})}),t.jsx(Ce,{isOpen:re,onClose:G,onCustomerDataChange:(e,a)=>{switch(e){case"name":A(a);break;case"address":B(a);break;case"tin":z(a);break;case"businessStyle":U(a);break}},customerName:F,customerAddress:R,customerTIN:k,customerBusinessStyle:J,onSave:le,setCustomerName:A,setCustomerAddress:B,setCustomerTIN:z,setCustomerBusinessStyle:U}),t.jsx(Te,{isOpen:Z,onOpenChange:d,cardNumber:h,setCardNumber:L,approvalCode:x,setApprovalCode:$,cardHolderName:S,setCardHolderName:V,onSave:async()=>{if(!h||!x||!S){i.error("Please fill in all card details.");return}d(!1),await j()}})]})}export{Gt as default};
