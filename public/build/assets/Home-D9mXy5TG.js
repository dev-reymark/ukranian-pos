import{r,j as e,Y as oe,c as v,a as ne,b as ie,d as N}from"./app-DJ0OCxwK.js";import{Q as le,X as ce,G as me,B as i}from"./index-CjPihSUo.js";import ue from"./MOPCard-5tvm-XkL.js";import{P as de,b as pe}from"./POSKeyboard-CFvMiQVm.js";import{PumpCard as fe}from"./PumpCard-zIFWhLTc.js";import{CustomerDetails as xe}from"./CustomerDetails-BJXZp5Gz.js";import{PrinterStatus as he}from"./PrinterStatus-D_444F3t.js";import{GetCashier as ge}from"./GetCashier-C70ZXMcB.js";import{GetDateTime as ye}from"./GetDateTime-DW6mrmFi.js";import{ThemeSwitcher as Se}from"./ThemeSwitcher-CKD5WiPK.js";import ve from"./Index-ChKOWB5U.js";import{CardDetails as Ne}from"./CardDetails-DNBVPHqk.js";import{SaleWindowTabs as je}from"./SaleWindowTabs-BZGo19Sl.js";import be from"./ReportsIndex-CN4UZPvV.js";import{s as Pe}from"./chunk-IXXDDLGU-C927SSi6.js";import{i as De}from"./chunk-GQQM5TNQ-P53s9ApC.js";import{t as Oe,a as j}from"./chunk-FXLYF44B-CXo7bLYM.js";import"./iconBase-BN3XEKHS.js";import"./index-BOPwCyX4.js";import"./SelectionManager-CiNkBuTg.js";import"./FocusScope-C3BCnoq3.js";import"./scrollIntoView-D_ErU28Z.js";import"./useControlledState-DF6__fTM.js";import"./chunk-44JHHBS2-CWPKxyw1.js";import"./useLabel-BEN_EtuV.js";import"./useLabels-C7uuHIf4.js";import"./useCollator-BqR0K-ta.js";import"./useListState-BnYXW82J.js";import"./index-2TX6XvHX.js";import"./index-3GMhIGNj.js";import"./chunk-P2T5LMDM-BSwoEP5i.js";import"./getScrollParent-CTiUb1E9.js";import"./VisuallyHidden-D0N98OxW.js";import"./chunk-DBLREEYE-C6Vwu_wX.js";import"./chunk-2PIR7DFM-CbcDDgM_.js";import"./PumpDelivery-B3Qbs3Ap.js";import"./chunk-YRZGWF2W-AeXPm49x.js";import"./chunk-KBN3H6OQ-CWXvv_JV.js";import"./useToggleState-BTeDqN7Y.js";import"./useFormReset-Dic5pjzl.js";import"./chunk-CAFRINWI-BTDo8zfp.js";import"./useFormValidationState-cOo1klYh.js";import"./LiveAnnouncer-q_S9a73M.js";import"./useHasTabbableChild-Daxskigl.js";import"./Icon-C3UHRYlP.js";import"./PumpStatus-5SYFXcQO.js";import"./chunk-QXREVWCS-CzOl0UnF.js";import"./chunk-4WFLSIHH-DHr-3Ab-.js";import"./chunk-M3MASYO7-CeYIKs2S.js";import"./chunk-JHUBASYZ-BiB9buEj.js";import"./ElectricJournal-Cu1TpWAi.js";import"./index-EUbz-fhy.js";import"./index-D834aa3t.js";import"./index-X92CTFGl.js";import"./AboutSoftware-CVR7ZnrI.js";import"./ApplicationLogo-ynUf4uBI.js";import"./PriceChange-B4fw-xZt.js";import"./chunk-RUXXUVWM-Dvg1qZRs.js";import"./NumberFormatter-DgUnyrzU.js";import"./index-B3MhTQ63.js";function Rt(){r.useState([]);const[b,p]=r.useState(""),[w,G]=r.useState([]),[V,J]=r.useState([]),[d,P]=r.useState(()=>{const t=localStorage.getItem("deliveryData");return t?JSON.parse(t):[]}),[f,_]=r.useState(null),[D,I]=r.useState(!1),[F,L]=r.useState(!1),u=r.useRef(null),[A,Ce]=r.useState([]),[H,U]=r.useState(0),[$,T]=r.useState(!1),[we,W]=r.useState(0),[K,M]=r.useState(!1),[x,Q]=r.useState(""),[h,X]=r.useState(""),[g,Y]=r.useState(""),[q,y]=r.useState(!1),[m,R]=r.useState({name:"",address:"",tin:"",businessStyle:""}),E=()=>{M(!1)},Z=()=>{E()},ee=(t,a)=>{R(n=>({...n,[t]:a}))},te=t=>{P(a=>{const n=[...a,t];return localStorage.setItem("deliveryData",JSON.stringify(n)),n})},O=(t,a)=>{a==="success"?i.success(t):a==="error"&&i.error(t)},k=()=>{L(!0),window.removeEventListener("click",k)};r.useEffect(()=>{window.addEventListener("click",k);const t=()=>{N.get("/get-pump-status").then(s=>{const l=s.data;G(l);const c=l.some(o=>o.Data.NozzleUp);F&&(c&&!D?(u.current&&(u.current.loop=!0,u.current.play().catch(o=>{console.error("Error playing sound:",o)})),I(!0)):!c&&D&&(u.current&&(u.current.pause(),u.current.currentTime=0),I(!1)))}).catch(s=>{console.error("Error fetching pump status:",s)})},a=()=>{N.get("/get-mop").then(s=>{J(s.data.data)}).catch(s=>{console.error("Error fetching MOP list:",s)})};t(),a();const n=setInterval(t,500);return()=>clearInterval(n)},[D,F]);const ae=async t=>{const a=parseFloat(b.replace("₱","").replace(",",""));if(b===""||a<=0){i.warning("Please enter an amount first.");return}const n=JSON.parse(localStorage.getItem("transaction"))||{subtotal:parseFloat(S),payments:[],remainingBalance:parseFloat(S)},s=n.remainingBalance-a;if(n.payments.push({mopName:t.MOP_Name,amount:a}),n.remainingBalance=s,localStorage.setItem("transaction",JSON.stringify(n)),t.MOP_Ref==="3"){y(!0);return}if(s>=0)s===0?await C():p(`Amount Due: ₱${s.toFixed(2)}`);else{const l=Math.abs(s).toFixed(2);i.success(`Change: ₱${l}`),p(`Change: ₱${l}`),n.remainingBalance=0,localStorage.setItem("transaction",JSON.stringify(n)),await C()}},S=d.reduce((t,a)=>t+parseFloat(a.Amount||0),0).toFixed(2),[se,z]=r.useState({change:0,mopNames:[],mopPayments:[],deliveryData:[]}),re=(t,a)=>{if(f==null){i.error("Please select an item to apply discount");return}if(t.discount_id>=1&&t.discount_id<=4){i.info("Discount not applicable");return}const n=d.map(s=>{if(s.Delivery_ID===f){if(s.DiscountedAmount)return i.info("Discount already applied to this item."),s;let l=0;switch(t==null?void 0:t.discount_type){case"1":l=parseFloat(s.Amount)*parseFloat(a==null?void 0:a.preset_value)/100;break;case"2":l=parseFloat(s.Volume)*parseFloat(a==null?void 0:a.preset_value);break;case"3":l=parseFloat(a==null?void 0:a.preset_value);break}const c=parseFloat(s.Amount)-l;return{...s,OriginalAmount:s.Amount,Amount:c.toFixed(2),DiscountedAmount:l.toFixed(2),PresetName:a==null?void 0:a.preset_name,DiscountType:t==null?void 0:t.discount_type,PresetValue:a==null?void 0:a.preset_value}}return s});P(n),i.success("Discount applied.")},C=async()=>{const t=JSON.parse(localStorage.getItem("transaction"));if(!t){i.error("No transaction found");return}if(A&&A.MOP_Ref==="3"&&(!x||!h||!g)){i.error("Please provide complete card details."),y(!0);return}const a=t.payments.reduce((l,c)=>l+c.amount,0),n=Math.max(0,a-t.subtotal).toFixed(2),s={name:m.name,address:m.address,tin:m.tin,businessStyle:m.businessStyle};try{const c=(await N.post("/store-transactions",{subtotal:t.subtotal,taxTotal:t.subtotal/1.12*.12,change:parseFloat(n),mopNames:t.payments.map(o=>o.mopName.trim()),mopPayments:t.payments,deliveryIds:d.map(o=>({Delivery_ID:o.Delivery_ID,Pump:o.Pump,Nozzle:o.Nozzle,Volume:o.Volume,Price:o.Price,Amount:o.Amount,OriginalAmount:o.OriginalAmount,DiscountedAmount:o.DiscountedAmount,DiscountType:o.DiscountType,PresetName:o.PresetName,PresetValue:o.PresetValue,FuelGradeName:o.FuelGradeName})),customer:s,cardDetails:{name:g,code:h,number:x}})).data.transaction;c?(localStorage.setItem("transactionId",c),i.success("Transaction saved"),T(!0),W(0),p("Transaction Complete"),z({change:parseFloat(n),mopNames:t.payments.map(o=>o.mopName),mopPayments:t.payments,deliveryData:d}),localStorage.removeItem("transaction"),R({}),B(c)):i.error("Error retrieving transaction ID")}catch{i.error("Error saving transaction")}},B=async t=>{if(!t){i.info("Please transact first");return}try{const n=(await N.get(`/print-receipt/${t}`)).data}catch{i.error("Error fetching receipt data")}};return e.jsxs(e.Fragment,{children:[e.jsx(oe,{title:"Home"}),e.jsx("audio",{ref:u,src:"assets/audio/nozzle-status-sound.wav"}),e.jsxs("main",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 p-2 h-[100vh] bg-gradient-to-bl from-blue-100 via-transparent dark:from-blue-950 dark:via-transparent",children:[e.jsxs(v,{className:"dark:bg-gray-900 p-2",children:[e.jsx("div",{children:e.jsxs(v,{className:"max-w-full h-full",children:[e.jsxs(ne,{className:"justify-between",children:[e.jsx(ge,{}),e.jsx(ye,{})]}),e.jsx(ie,{className:"justify-between",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-[70%] h-[65px] bg-slate-200 rounded-lg shadow-sm relative",children:e.jsx(le,{autoClose:2e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,pauseOnFocusLoss:!1,draggable:!0,pauseOnHover:!1,theme:"light",transition:ce,style:{position:"absolute",top:0,right:0,bottom:0,left:0,width:"100%"}})}),e.jsx(he,{}),e.jsx(Se,{})]})})]})}),e.jsx(Pe,{y:3}),e.jsx("div",{className:"flex-grow",children:e.jsx(je,{deliveryData:d,setSelectedRow:_,subtotal:S,transactionSaved:$,transactionSummary:se})}),e.jsx("div",{children:e.jsxs(v,{className:"w-full gap-2 p-2",children:[e.jsx(De,{variant:"bordered",classNames:{input:["text-black text-2xl font-bold text-right"]},value:b,isReadOnly:!0,size:"lg"}),e.jsx(de,{setDeliveryData:P,deliveryData:d,setSelectedRow:_,selectedRow:f,subtotal:S,onToast:O,buttons:pe,setInputValue:p,setTransactionSummary:z,setTransactionSaved:T,setCustomerModalOpen:M,setTotalPaid:U,totalPaid:H,handlePrintReceipt:B})]})})]}),e.jsx(v,{className:"dark:bg-gray-900 p-2",children:e.jsx("div",{className:"flex w-full flex-col",children:e.jsxs(Oe,{"aria-label":"Pumps",fullWidth:!0,children:[e.jsx(j,{title:e.jsx("p",{className:"font-extrabold",children:"PUMPS"}),children:w.length===0?e.jsxs("div",{className:"col-span-4 flex flex-col items-center justify-center py-12 text-xl font-extrabold text-center text-red-500",children:[e.jsx(me,{className:"text-7xl"}),e.jsx("p",{children:"No pumps connected!"})]}):e.jsx("div",{className:"overflow-y-auto scrollbar-hide max-h-screen p-1",children:e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2",children:w.map(t=>e.jsx(fe,{pump:t,handleAppendDeliveryData:te,onToast:O},t.Id))})})},"pumps"),e.jsx(j,{title:e.jsx("p",{className:"font-extrabold",children:"MOP"}),children:e.jsx(ue,{mopList:V,onSelectMOP:ae,onApplyDiscount:re})},"mop"),e.jsx(j,{title:e.jsx("p",{className:"font-extrabold",children:"REPORTS"}),children:e.jsx(be,{})},"reports"),e.jsx(j,{title:e.jsx("p",{className:"font-extrabold",children:"CONFIG"}),children:e.jsx(ve,{onToast:O})},"config")]})})})]}),e.jsx(xe,{isOpen:K,onClose:E,onCustomerDataChange:ee,customerName:m.name,customerAddress:m.address,customerTIN:m.tin,customerBusinessStyle:m.businessStyle,onSave:Z}),e.jsx(Ne,{isOpen:q,onOpenChange:y,cardNumber:x,setCardNumber:Q,approvalCode:h,setApprovalCode:X,cardHolderName:g,setCardHolderName:Y,onSave:async()=>{if(!x||!h||!g){i.error("Please fill in all card details.");return}y(!1),await C()}})]})}export{Rt as default};
