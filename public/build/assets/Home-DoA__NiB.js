import{r as o,j as t,Y as q,a as m}from"./app-DES__7Rh.js";import{F as Q}from"./PumpDelivery-Gl8argpE.js";import{I as X,_ as r}from"./index-05l4KRer.js";import{S as Z,t as ee,a as M}from"./SaleWindowTabs-Cp2kD8W5.js";import te from"./MOPCard-CBOiqpGD.js";import se,{buttons as ae}from"./POSKeyboard-CNaFEk5q.js";import re from"./PumpCard-DQE-LsPL.js";import{c as y}from"./chunk-H4VOEXHF-UGMiky7P.js";import{i as A}from"./chunk-GQQM5TNQ-CjG2HoVm.js";import"./chunk-2PIR7DFM-CbcDDgM_.js";import"./chunk-N2KXC5ZE-C6Y5_qAY.js";import"./chunk-YRZGWF2W-VdmQgllv.js";import"./useHover-hBRi7EPs.js";import"./chunk-XHQUSKIE-CdgHa3t2.js";import"./index-BwqF1hgy.js";import"./index-C_l4pJZK.js";import"./useControlledState-BfXFq5lj.js";import"./chunk-IXXDDLGU-CBi3wocM.js";import"./chunk-DBLREEYE-DzWOEzsw.js";import"./index-BOxUIzwV.js";import"./chunk-6NL67ZRH-CGxmtYsH.js";import"./useLabels-CiTM48rr.js";import"./Icon-DxCyxRri.js";import"./PumpStatus-5SYFXcQO.js";import"./index-BgSJHXOM.js";import"./chunk-P2T5LMDM-DiKVnhXX.js";function Fe(){const[u,i]=o.useState(""),[w,F]=o.useState([]),[z,T]=o.useState([]),[p,v]=o.useState(()=>{const e=localStorage.getItem("deliveryData");return e?JSON.parse(e):[]}),[f,b]=o.useState(null),[S,j]=o.useState(!1),[I,R]=o.useState(!1),c=o.useRef(null),[P,D]=o.useState([]),[g,h]=o.useState(0),[oe,U]=o.useState(!1),[le,C]=o.useState(0),k=e=>{v(a=>{const s=[...a,e];return localStorage.setItem("deliveryData",JSON.stringify(s)),s})},L=()=>{i("")},V=()=>{i(`Subtotal: ₱${d}`)},J=()=>{if(p.length===0){r.error("No transactions to void");return}v([]),localStorage.removeItem("deliveryData"),localStorage.removeItem("disabledIds"),r.success("All transactions voided."),h(0),window.dispatchEvent(new Event("disabledIdsUpdated"))},$=()=>{if(console.log("Selected Row:",f),f!==null){const e=p.filter(n=>n.Delivery_ID!==f);v(e),localStorage.setItem("deliveryData",JSON.stringify(e)),r.success("Transaction voided"),b(null);const a=e.reduce((n,x)=>n+parseFloat(x.Amount||0),0).toFixed(2),s=Math.max(0,g-a).toFixed(2);h(g),i(s);const l=localStorage.getItem("disabledIds");if(l){const n=new Set(JSON.parse(l));n.delete(f),localStorage.setItem("disabledIds",JSON.stringify(Array.from(n))),window.dispatchEvent(new Event("disabledIdsUpdated"))}}else r.error("No transaction selected")},E=()=>{R(!0),window.removeEventListener("click",E)};o.useEffect(()=>{window.addEventListener("click",E);const e=()=>{m.get("/get-pump-status").then(l=>{const n=l.data;F(n);const x=n.some(N=>N.Data.NozzleUp);I&&(x&&!S?(c.current&&(c.current.loop=!0,c.current.play().catch(N=>{console.error("Error playing sound:",N)})),j(!0)):!x&&S&&(c.current&&(c.current.pause(),c.current.currentTime=0),j(!1)))}).catch(l=>{console.error("Error fetching pump status:",l)})},a=()=>{m.get("/get-mop").then(l=>{T(l.data.data)}).catch(l=>{console.error("Error fetching MOP list:",l)})};e(),a();const s=setInterval(e,500);return()=>clearInterval(s)},[S,I]);const B=e=>{i(a=>a+e),h(a=>a+e)},G=async()=>{try{const e=await m.post("/stop-all-pumps");r.success("All pumps stopped successfully"),console.log("All pumps stopped:",e.data)}catch(e){r.error("Error stopping all pumps"),console.error("Error stopping all pumps:",e)}},O=async e=>{if(!e){r.error("Transaction ID is undefined");return}try{const s=(await m.get(`/print-receipt/${e}`)).data}catch(a){r.error("Error fetching receipt data"),console.error("Error fetching receipt data:",a)}},H={handleVoid:$,handleVoidAll:J,setInputValue:i,handleClear:L,handleSubTotal:V,handlePrintReceipt:O,handleStopAllPumps:G},W=async e=>{if(console.log("MOP selected:",e),u===""||parseFloat(u.replace("₱","").replace(",",""))<=0){r.error("Please enter an amount before selecting a method of payment.");return}D(e),await Y()},d=p.reduce((e,a)=>e+parseFloat(a.Amount||0),0).toFixed(2),K=d/1.12*.12,_=g-d,Y=async()=>{if(!P){r.error("Please select a method of payment");return}if(p.length===0){r.error("No transactions to save");return}try{const a=(await m.post("/store-transactions",{subtotal:d,taxTotal:K,change:_,mopName:P.MOP_Name.trim(),deliveryIds:p.map(s=>({Delivery_ID:s.Delivery_ID,Pump:s.Pump,Nozzle:s.Nozzle,Volume:s.Volume,Price:s.Price,Amount:s.Amount,FuelGradeName:s.FuelGradeName})),payment:u})).data.transaction;if(a){r.success("Transaction saved successfully"),U(!0);const s=d-g;C(s),s>0?i(`Amount Due: ₱${s.toFixed(2)}`):i(`Change: ₱${Math.abs(s).toFixed(2)}`),D(null),h(0),await O(a)}else r.error("Error retrieving transaction ID")}catch(e){r.error("Error saving transaction"),console.error("Error saving transaction:",e)}};return t.jsxs(t.Fragment,{children:[t.jsx(q,{title:"Home"}),t.jsx("audio",{ref:c,src:"assets/audio/nozzle-status-sound.wav"}),t.jsx(X,{position:"top-right"}),t.jsx("div",{className:"min-h-screen p-3",children:t.jsx("main",{className:"w-full h-full mx-auto",children:t.jsxs("div",{className:"grid gap-6 lg:grid-cols-2 lg:gap-4",children:[t.jsxs(y,{className:"flex flex-col h-full p-3",children:[t.jsx("div",{className:"flex-grow",children:t.jsx(Z,{deliveryData:p,setSelectedRow:b,subtotal:d,inputValue:u,change:_})}),t.jsxs(y,{className:"w-full gap-2 p-2",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx(A,{variant:"bordered",label:t.jsx("p",{className:"font-bold",children:"SUBTOTAL"}),size:"lg",value:`₱${d}`,labelPlacement:"outside-left",className:"w-[35%]",classNames:{input:["text-black text-xl font-bold text-right"]},isReadOnly:!0}),t.jsx(A,{variant:"bordered",className:"w-[70%]",classNames:{input:["text-black text-2xl font-bold text-right"]},value:u,isReadOnly:!0,size:"lg"})]}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-1",children:t.jsx(se,{handleButtonClick:B,buttons:ae,buttonClickHandlers:H,setInputValue:i})})]})]}),t.jsx(y,{className:"flex items-start gap-4 rounded-lg bg-white p-6 shadow-[0px_14px_34px_0px_rgba(0,0,0,0.08)] ring-1 ring-white/[0.05] lg:pb-10",children:t.jsx("div",{className:"flex w-full flex-col",children:t.jsxs(ee,{"aria-label":"Options",fullWidth:!0,children:[t.jsx(M,{title:"PUMPS",children:w.length===0?t.jsxs("div",{className:"flex flex-col items-center mt-6",children:[t.jsx(Q,{className:"w-12 h-12 text-danger"}),t.jsx("span",{className:"mt-4",children:"No pumps found"})]}):t.jsx("div",{className:"overflow-y-auto max-h-[calc(100vh-200px)] p-2",children:t.jsx("div",{className:"grid grid-cols-4 gap-2",children:w.map(e=>t.jsx(re,{pump:e,handleAppendDeliveryData:k},e.Id))})})},"pumps"),t.jsx(M,{title:"MOP",children:t.jsx("div",{className:"grid grid-cols-4 gap-4",children:t.jsx(te,{mopList:z,onSelectMOP:W})})},"mop")]})})})]})})})]})}export{Fe as default};
