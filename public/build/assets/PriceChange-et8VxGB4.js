import{r as l,d as N,j as e,c as _,a as v,b as I}from"./app-DQR8ouMN.js";import{I as V,_ as S}from"./index-DDrqCaiR.js";import{$ as u,a as x,d as Y}from"./chunk-RUXXUVWM-CByahhe-.js";import{c as q}from"./chunk-6EHM2IL6-Cx_Mjnao.js";import{c as z}from"./chunk-KBN3H6OQ-nz5roQ3_.js";import{m as M,a as B,b as H,c as K,d as U}from"./chunk-P2T5LMDM-MUOmPblZ.js";import{d as o}from"./chunk-44JHHBS2-BSFQFpH5.js";import{s as y}from"./chunk-IXXDDLGU-BtRYqgzk.js";import{i as C}from"./chunk-GQQM5TNQ-BZdn_sLp.js";import{b as E}from"./chunk-DBLREEYE-CoXvdbmO.js";import"./useControlledState-DsOKAyM-.js";import"./getScrollParent-CSIo9Hxx.js";import"./FocusScope-DMt3cHMA.js";import"./useFormValidationState-BGLjVBHh.js";import"./scrollIntoView-B1mZhU84.js";import"./useFormReset-DweNStx9.js";import"./useLabels-CSRCNtbm.js";import"./NumberFormatter-DgUnyrzU.js";import"./useCollator-5Zmd5rxj.js";import"./LiveAnnouncer-C2oPZAHC.js";import"./chunk-2PIR7DFM-CbcDDgM_.js";import"./index-X92CTFGl.js";import"./VisuallyHidden-DiWMGts7.js";import"./chunk-CAFRINWI-BTDo8zfp.js";import"./useToggleState-alzNwMpt.js";import"./index-goXRPerO.js";import"./useLabel-BpByWgep.js";import"./chunk-M3MASYO7-DJpgnKTJ.js";function _e({isOpen:c,onOpenChange:G,onToast:p}){const[n,F]=l.useState([]),[i,D]=l.useState([]),[f,h]=l.useState({}),[d,g]=l.useState({}),[$,j]=l.useState(!1),[k,m]=l.useState(!1),[P,w]=l.useState(u(x()).add({minutes:5})),R=s=>{w(s)};l.useEffect(()=>{c&&N.get("/get-fuel-grades").then(s=>{console.log("Fuel grades response:",s.data);const r=s.data;F(r||[]);const a={};r.forEach(t=>{a[t.Id]=t.Price.toString()}),h(a)}).catch(s=>{console.error("Error fetching grades:",s)})},[c]);const A=s=>{D(s)},L=(s,r)=>{g(a=>({...a,[s]:r}))},T=()=>{if(i.length===0){p("No grades selected","error");return}if(!P){p("Please select an effectivity date","error");return}if(i.some(t=>{const b=d[t];return!b||isNaN(parseFloat(b))})){m(!0);return}m(!1);const a={Protocol:"jsonPTS",Packets:[{Id:1,Type:"SetFuelGradesConfiguration",Data:{FuelGrades:n.map(t=>i.includes(t.Id.toString())?{...t,Price:parseFloat(d[t.Id]||f[t.Id]),isSelected:!0}:{...t,isSelected:!1})}}],EffectivityDate:P.toString()};j(!0),N.post("/set-fuel-grades",a).then(()=>{S.success("Prices updated successfully!");const t={...f,...d};h(t),g({})}).catch(t=>{console.error("Error updating prices:",t),S.error("Failed to update prices")}).finally(()=>{j(!1),m(!1)})};return e.jsxs(e.Fragment,{children:[e.jsx(V,{position:"top-center"}),e.jsx(M,{isDismissable:!1,isKeyboardDismissDisabled:!0,size:"4xl",isOpen:c,onOpenChange:G,hideCloseButton:!0,children:e.jsx(B,{children:s=>e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"flex flex-col gap-1",children:e.jsx("h1",{className:"text-2xl font-extrabold",children:"PRICE CHANGE"})}),e.jsx(o,{}),e.jsx(y,{y:2}),e.jsxs(K,{className:"w-full mx-auto p-3",children:[e.jsx(Y,{variant:"faded",label:e.jsx("p",{className:"text-lg font-extrabold",children:"EFFECTIVITY"}),labelPlacement:"outside-left",showMonthAndYearPickers:!0,minValue:u(x()),defaultValue:u(x()).add({minutes:5}),onChange:R}),e.jsx(y,{y:2}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(_,{children:[e.jsx(v,{children:e.jsx("h2",{className:"text-xl font-extrabold",children:"Grades"})}),e.jsx(o,{}),e.jsx(I,{className:"p-4",children:e.jsx(q,{label:"Select Grades",onChange:A,children:n.map(r=>e.jsx(z,{className:"text-xl font-semibold",size:"lg",value:r.Id.toString(),children:r.Name.trim()},r.Id))})})]}),e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex-1 overflow-auto space-y-4 p-2",children:[e.jsx("div",{className:"grid grid-cols-3 gap-2",children:i.map(r=>{const a=n.find(t=>t.Id.toString()===r);return e.jsxs(_,{children:[e.jsx(v,{children:e.jsx("h2",{className:"text-xl font-extrabold",children:a.Name.trim()})}),e.jsx(o,{}),e.jsxs(I,{className:"gap-1 p-2",children:[e.jsx(C,{label:"Current Price",value:f[a.Id],isReadOnly:!0}),e.jsx(C,{label:"New Price",value:d[a.Id]||"",onChange:t=>L(a.Id,t.target.value),isRequired:!0,isInvalid:k,errorMessage:"Price not set"})]})]},a.Id)})}),i.length===0&&e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-xl font-bold text-red-600",children:"No grades selected"})})]}),e.jsx(E,{color:"primary",fullWidth:!0,onClick:T,isLoading:$,className:"text-xl font-bold",children:"APPLY"})]})]})]}),e.jsx(o,{}),e.jsx(U,{children:e.jsx(E,{color:"danger",onPress:s,children:"Close"})})]})})})]})}export{_e as default};
